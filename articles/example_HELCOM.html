<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="harsat">
<title>HELCOM • harsat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="HELCOM">
<meta property="og:description" content="harsat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">harsat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.1000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/harsat.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>File formats</h6>
    <a class="dropdown-item" href="../articles/external-file-format.html">External file format</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Examples</h6>
    <a class="dropdown-item" href="../articles/example_external_data.html">External data</a>
    <a class="dropdown-item" href="../articles/example_simple_ospar.html">Simple OSPAR</a>
    <a class="dropdown-item" href="../articles/example_helcom.html">HELCOM</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/osparcomm/HARSAT/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>HELCOM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/osparcomm/HARSAT/blob/HEAD/vignettes/example_HELCOM.Rmd" class="external-link"><code>vignettes/example_HELCOM.Rmd</code></a></small>
      <div class="d-none name"><code>example_HELCOM.Rmd</code></div>
    </div>

    
    
<p>This is a brief example of using the <code>harsat</code> with
HELCOM-style data.</p>
<p>First, load the <code>harsat</code> the library</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/osparcomm/HARSAT" class="external-link">harsat</a></span><span class="op">)</span></span></code></pre></div>
<p>And load the R package <code>here</code>, because we use the working
directory to find the data files. If you use your own data files, you
will need to point to a directory containing a copy.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; here() starts at /Users/stuart/git/HARSAT</span></span>
<span><span class="va">working.directory</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Load the biota data, using HELCOM-style.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span> <span class="op">&lt;-</span> <span class="fu">ctsm_read_data</span><span class="op">(</span></span>
<span>  compartment <span class="op">=</span> <span class="st">"biota"</span>,</span>
<span>  purpose <span class="op">=</span> <span class="st">"HELCOM"</span>,</span>
<span>  contaminants <span class="op">=</span> <span class="st">"biota_data.csv"</span>, </span>
<span>  stations <span class="op">=</span> <span class="st">"station_dictionary.csv"</span>, </span>
<span>  QA <span class="op">=</span> <span class="st">"quality_assurance.csv"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"data"</span>, <span class="st">"example_HELCOM"</span><span class="op">)</span>,</span>
<span>  info_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"information"</span><span class="op">)</span>,</span>
<span>  extraction <span class="op">=</span> <span class="st">"2022/10/06"</span>,</span>
<span>  max_year <span class="op">=</span> <span class="fl">2021L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading station dictionary from:</span></span>
<span><span class="co">#&gt;  '/Users/stuart/git/HARSAT/data/example_HELCOM/station_dictionary.csv'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reading contaminant and biological effects data from:</span></span>
<span><span class="co">#&gt;  '/Users/stuart/git/HARSAT/data/example_HELCOM/biota_data.csv'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reading QA data from '/Users/stuart/git/HARSAT/data/example_HELCOM/quality_assurance.csv'</span></span></code></pre></div>
<p>Next, load the sediment data, again using HELCOM-style.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sediment_data</span> <span class="op">&lt;-</span> <span class="fu">ctsm_read_data</span><span class="op">(</span></span>
<span>  compartment <span class="op">=</span> <span class="st">"sediment"</span>,</span>
<span>  purpose <span class="op">=</span> <span class="st">"HELCOM"</span>,</span>
<span>  contaminants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">".."</span>, <span class="st">"example_HELCOM_new_format"</span>, <span class="st">"sediment_data.csv"</span><span class="op">)</span>,</span>
<span>  stations <span class="op">=</span> <span class="st">"station_dictionary.csv"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"data"</span>, <span class="st">"example_HELCOM"</span><span class="op">)</span>,</span>
<span>  info_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"information"</span><span class="op">)</span>,</span>
<span>  extraction <span class="op">=</span> <span class="st">"2022/10/06"</span>,</span>
<span>  max_year <span class="op">=</span> <span class="fl">2021L</span>,</span>
<span>  data_format <span class="op">=</span> <span class="st">"ICES_new"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading station dictionary from:</span></span>
<span><span class="co">#&gt;  '/Users/stuart/git/HARSAT/data/example_HELCOM/station_dictionary.csv'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reading contaminant and biological effects data from:</span></span>
<span><span class="co">#&gt;  '/Users/stuart/git/HARSAT/data/example_HELCOM/../example_HELCOM_new_format/sediment_data.csv'</span></span></code></pre></div>
<p>And finally, read the water data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_data</span> <span class="op">&lt;-</span> <span class="fu">ctsm_read_data</span><span class="op">(</span></span>
<span>  compartment <span class="op">=</span> <span class="st">"water"</span>,</span>
<span>  purpose <span class="op">=</span> <span class="st">"HELCOM"</span>,</span>
<span>  contaminants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">".."</span>, <span class="st">"example_HELCOM_new_format"</span>, <span class="st">"water_data.csv"</span><span class="op">)</span>,</span>
<span>  stations <span class="op">=</span> <span class="st">"station_dictionary.csv"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"data"</span>, <span class="st">"example_HELCOM"</span><span class="op">)</span>,</span>
<span>  info_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"information"</span><span class="op">)</span>,</span>
<span>  extraction <span class="op">=</span> <span class="st">"2022/10/06"</span>,</span>
<span>  max_year <span class="op">=</span> <span class="fl">2021L</span>, </span>
<span>  data_format <span class="op">=</span> <span class="st">"ICES_new"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading station dictionary from:</span></span>
<span><span class="co">#&gt;  '/Users/stuart/git/HARSAT/data/example_HELCOM/station_dictionary.csv'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reading contaminant and biological effects data from:</span></span>
<span><span class="co">#&gt;  '/Users/stuart/git/HARSAT/data/example_HELCOM/../example_HELCOM_new_format/water_data.csv'</span></span></code></pre></div>
<p>Now we can perform any adjustments we need to make. In this case,
we’re correcting known errors in the data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">info_TEQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"CB77"</span> <span class="op">=</span> <span class="fl">0.0001</span>, <span class="st">"CB81"</span> <span class="op">=</span> <span class="fl">0.0003</span>, <span class="st">"CB105"</span> <span class="op">=</span> <span class="fl">0.00003</span>, <span class="st">"CB118"</span> <span class="op">=</span> <span class="fl">0.00003</span>,</span>
<span>  <span class="st">"CB126"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"CB156"</span> <span class="op">=</span> <span class="fl">0.00003</span>, <span class="st">"CB157"</span> <span class="op">=</span> <span class="fl">0.00003</span>, <span class="st">"CB167"</span> <span class="op">=</span> <span class="fl">0.00003</span>,</span>
<span>  <span class="st">"CB169"</span> <span class="op">=</span> <span class="fl">0.03</span>, <span class="st">"CDD1N"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"CDD4X"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"CDD6P"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"CDD6X"</span> <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="st">"CDD9X"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"CDDO"</span> <span class="op">=</span> <span class="fl">0.0003</span>, <span class="st">"CDF2N"</span> <span class="op">=</span> <span class="fl">0.3</span>, <span class="st">"CDF2T"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"CDF4X"</span> <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  <span class="st">"CDF6P"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"CDF6X"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"CDF9P"</span> <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  <span class="st">"CDF9X"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"CDFO"</span> <span class="op">=</span> <span class="fl">0.00003</span>, <span class="st">"CDFP2"</span> <span class="op">=</span> <span class="fl">0.03</span>, <span class="st">"CDFX1"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"TCDD"</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="data-adjustments-water">Data adjustments: water<a class="anchor" aria-label="anchor" href="#data-adjustments-water"></a>
</h3>
<p>We’ll use the <code>DT</code> package for some of these adjustments,
and <code>lattice</code> to plot some of the data so we can see it as we
go.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching core tidyverse packages ───────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr     1.1.2     ✔ readr     2.1.4</span></span>
<span><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.0</span></span>
<span><span class="co">#&gt; ✔ ggplot2   3.4.2     ✔ tibble    3.2.1</span></span>
<span><span class="co">#&gt; ✔ lubridate 1.9.2     ✔ tidyr     1.3.0</span></span>
<span><span class="co">#&gt; ✔ purrr     1.0.1     </span></span>
<span><span class="co">#&gt; ── Conflicts ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">DT_options</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  initComplete <span class="op">=</span> <span class="fu">htmlwidgets</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmlwidgets/man/JS.html" class="external-link">JS</a></span><span class="op">(</span></span>
<span>    <span class="st">"function(settings, json) {"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"$(this.api().table().container()).css({'font-size': '"</span>, <span class="st">"10pt"</span>, <span class="st">"'});"</span><span class="op">)</span>,</span>
<span>    <span class="st">"}"</span><span class="op">)</span></span>
<span><span class="op">)</span> </span></code></pre></div>
<div class="section level4">
<h4 id="data-summary">Data summary<a class="anchor" aria-label="anchor" href="#data-summary"></a>
</h4>
<p>Here is a summary of the submissions for each country, first by
determinand and then by year.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country       CD   PB PFOS TBSN+</span></span>
<span><span class="co">#&gt;   Estonia     29   29   28    23</span></span>
<span><span class="co">#&gt;   Germany   1371 1349    5   156</span></span>
<span><span class="co">#&gt;   Lithuania  267  267   47    55</span></span>
<span><span class="co">#&gt;   Poland     862  854   36   375</span></span>
<span><span class="co">#&gt;   Russia      23   23    .     .</span></span>
<span></span>
<span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     1995 1998 1999 2000 2003 2004 2005 2006 2007 2008 2009 2010 2011</span></span>
<span><span class="co">#&gt;   Estonia      .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Germany      .   88   87  176   73  154  158  114  138  206  189  213   82</span></span>
<span><span class="co">#&gt;   Lithuania    .    .    .    .    .    .    .    .   46   46   48   38   49</span></span>
<span><span class="co">#&gt;   Poland       .    .    .    .    .    .    .    .    .    .    .    .  133</span></span>
<span><span class="co">#&gt;   Russia       4   42    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;   Estonia      .    .    .    .    .   17    4   36   20   32</span></span>
<span><span class="co">#&gt;   Germany     98  134   82  122  121  142  136  129  135  104</span></span>
<span><span class="co">#&gt;   Lithuania   52   42   42   66   16    .   81   46   64    .</span></span>
<span><span class="co">#&gt;   Poland     181   72  144   72  479  540  143  159  108   96</span></span>
<span><span class="co">#&gt;   Russia       .    .    .    .    .    .    .    .    .    .</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="matrix-issues">Matrix issues<a class="anchor" aria-label="anchor" href="#matrix-issues"></a>
</h4>
<p>Here is a summary of the matrix and filtration data. Data with matrix
SPM are deleted.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">water_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  filtered <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"NF"</span>, <span class="va">method_pretreatment</span><span class="op">)</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">matrix</span>, <span class="va">filtered</span>, useNA <span class="op">=</span> <span class="st">"ifany"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;       filtered</span></span>
<span><span class="co">#&gt; matrix   No  Yes</span></span>
<span><span class="co">#&gt;    SPM   36    .</span></span>
<span><span class="co">#&gt;    WT  2074 3689</span></span>
<span></span>
<span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">water_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="va">matrix</span> <span class="op">==</span> <span class="st">"WT"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="duplicate-records">Duplicate records<a class="anchor" aria-label="anchor" href="#duplicate-records"></a>
</h4>
<p>The following samples have duplicated records - only the first is
retained.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span>  </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sample</span>, <span class="va">determinand</span>, <span class="va">filtered</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>, <span class="va">station_name</span>, <span class="va">sample</span>, <span class="va">determinand</span>, <span class="va">filtered</span>, <span class="va">replicate</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>, <span class="va">sample</span>, <span class="va">determinand</span>, <span class="va">replicate</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="va">DT_options</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(name): there is no package called 'webshot'</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_rep</span> <span class="op">&lt;-</span> <span class="va">wk</span><span class="op">$</span><span class="va">replicate</span></span>
<span></span>
<span><span class="va">wk_keep</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">sample</span>, <span class="va">determinand</span>, <span class="va">filtered</span>, <span class="va">replicate</span>, <span class="va">station_name</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">sample</span>, <span class="va">determinand</span>, <span class="va">filtered</span>, <span class="va">value</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_drop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">wk_rep</span>, <span class="va">wk_keep</span><span class="op">)</span></span>
<span></span>
<span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">water_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="va">replicate</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_drop</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtration-issues">Filtration issues<a class="anchor" aria-label="anchor" href="#filtration-issues"></a>
</h4>
<p>Here’s a summary of whether the data have been filtered or not by
determinand. All PFOS and TBSN+ are unfiltered, which is fine. However,
there could be issues with the metals data, since there are both
filtered (preferred) and unfiltered samples.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">filtered</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            filtered</span></span>
<span><span class="co">#&gt; determinand   No  Yes</span></span>
<span><span class="co">#&gt;       CD     677 1831</span></span>
<span><span class="co">#&gt;       PB     659 1845</span></span>
<span><span class="co">#&gt;       PFOS   116    .</span></span>
<span><span class="co">#&gt;       TBSN+  609    .</span></span></code></pre></div>
<p>Here’s a more detailed look at the metals data (having excluded the
Russian data which are too old).</p>
<ul>
<li>
<strong>Estonia</strong>: all samples are filtered.</li>
<li>
<strong>Germany</strong>: a real mixture which is explored more
below.</li>
<li>
<strong>Lithuania</strong>: the only unfiltered data are from 2007
(the first year of data). Maybe these were filtered data and have been
submitted incorrectly. For now they are treated as unfiltered (and will
drop out of the assessment because there are no unfiltered data in the
last six monitoring years)</li>
<li>
<strong>Poland</strong>: all samples are filtered.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">water_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="va">country</span> <span class="op">!=</span> <span class="st">"Russia"</span>,</span>
<span>  <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD"</span>, <span class="st">"PB"</span><span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span>  </span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">filtered</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;         country</span></span>
<span><span class="co">#&gt; filtered Estonia Germany Lithuania Poland</span></span>
<span><span class="co">#&gt;      No        .    1244        46      .</span></span>
<span><span class="co">#&gt;      Yes      58    1414       488   1716</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">filtered</span>, <span class="va">year</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , country = Estonia</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 1998 1999 2000 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013</span></span>
<span><span class="co">#&gt;      No     .    .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      Yes    .    .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;      No     .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      Yes    .    .    .   12    2   18   10   16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Germany</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 1998 1999 2000 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013</span></span>
<span><span class="co">#&gt;      No    88   87  176   73  154  119   24   24   32   32   69   62   36   32</span></span>
<span><span class="co">#&gt;      Yes    .    .    .    .    .   13   90  114  174  121  144   20   62  102</span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;      No    24   32   20   44   48   22   46    .</span></span>
<span><span class="co">#&gt;      Yes   58   90   96   68   66   72   58   66</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Lithuania</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 1998 1999 2000 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013</span></span>
<span><span class="co">#&gt;      No     .    .    .    .    .    .    .   46    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      Yes    .    .    .    .    .    .    .    .   46   48   34   40   40   42</span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;      No     .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      Yes   42   34    .    .   58   46   58    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Poland</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 1998 1999 2000 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013</span></span>
<span><span class="co">#&gt;      No     .    .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      Yes    .    .    .    .    .    .    .    .    .    .    .  123  151   72</span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;      No     .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      Yes  144   72  336  348  143  147   96   84</span></span></code></pre></div>
<div class="section level5">
<h5 id="german-metals-data">German metals data<a class="anchor" aria-label="anchor" href="#german-metals-data"></a>
</h5>
<p>Here are the stations with metals data in the last six monitoring
years (2016-2021); the second column shows whether the metal samples in
this period were all filtered, all unfiltered, or a mixture.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Germany"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">wk_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"filtered"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="st">"No"</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"unfiltered"</span><span class="op">)</span></span>
<span>  <span class="st">"mixture"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">wk1</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>type <span class="op">=</span> <span class="fu">wk_fun</span><span class="op">(</span><span class="va">filtered</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop_last"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">wk1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="va">DT_options</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(name): there is no package called 'webshot'</span></span></code></pre></div>
<p>There are three stations where there is a mixture. Here are the full
records of samples at these stations. These look intentional. Filtered
and unfiltered samples will be analysed as separate time series.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="va">wk1</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"mixture"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">station_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">filtered</span>, <span class="va">year</span>, <span class="va">station_name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , station_name = OMBMPM2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018</span></span>
<span><span class="co">#&gt;      No     1    2    4    4    4    8    4    4    4    2    2    2    4    4</span></span>
<span><span class="co">#&gt;      Yes    1    2    2    2    4    .    .    .    .    .    .    2    .    .</span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2019 2020</span></span>
<span><span class="co">#&gt;      No     2    4</span></span>
<span><span class="co">#&gt;      Yes    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , station_name = OMBMPN3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018</span></span>
<span><span class="co">#&gt;      No     .    .    .    4    4    8    4    4    4    2    4    2    4    4</span></span>
<span><span class="co">#&gt;      Yes    .    .    .    2    4    .    .    .    .    .    .    2    .    .</span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2019 2020</span></span>
<span><span class="co">#&gt;      No     2    2</span></span>
<span><span class="co">#&gt;      Yes    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , station_name = OMO22</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018</span></span>
<span><span class="co">#&gt;      No     .    .    4    4    4    4    4    4    4    2    2    2    4    4</span></span>
<span><span class="co">#&gt;      Yes    .    .    .    .    .   20    .    .    .    .    .    .   12    .</span></span>
<span><span class="co">#&gt;         year</span></span>
<span><span class="co">#&gt; filtered 2019 2020</span></span>
<span><span class="co">#&gt;      No     2    4</span></span>
<span><span class="co">#&gt;      Yes    .    8</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="zero-concentrations">Zero concentrations<a class="anchor" aria-label="anchor" href="#zero-concentrations"></a>
</h5>
<p>Some metals concentrations from Lithuania in 2008 have been reported
with value = 0. These measurements are less than the LoQ (Nijole 22
August) so the value has been replaced by the LoQ. (There are no
uncertainties reported, so there is no need to adjust these.)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">water_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  .id <span class="op">=</span> <span class="va">value</span> <span class="op">==</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">.id</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">23</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"something has changed - investigate"</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span>
<span></span>
<span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span></span>
<span>    <span class="va">country</span>, <span class="va">year</span>, <span class="va">determinand</span>, <span class="va">value</span>, <span class="va">censoring</span>, <span class="va">limit_detection</span>, </span>
<span>    <span class="va">limit_quantification</span>, <span class="va">uncertainty</span>, <span class="va">unit_uncertainty</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="va">DT_options</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(name): there is no package called 'webshot'</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">water_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  value <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.id</span>, <span class="va">limit_quantification</span>, <span class="va">value</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="sediment">Sediment<a class="anchor" aria-label="anchor" href="#sediment"></a>
</h3>
<div class="section level4">
<h4 id="data-summary-1">Data summary<a class="anchor" aria-label="anchor" href="#data-summary-1"></a>
</h4>
<p>Here is a summary of the submissions for each country, first by
determinand and then by year. The grain size fraction data have been
omitted for simplicity.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"GSMF"</span>, <span class="va">determinand</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country      AL ANT BD100 BD153 BD154 BDE28 BDE47 BDE99  CD CORG CTOT  CU</span></span>
<span><span class="co">#&gt;   Denmark   498 374   111    56   114     .    98   104 479  467   30 485</span></span>
<span><span class="co">#&gt;   Estonia    23  28    30    30    30    30    30    30  28   23    .  28</span></span>
<span><span class="co">#&gt;   Finland     8  22     9     9     9     9     9     9  20    8    .   8</span></span>
<span><span class="co">#&gt;   Germany   307 129     4     4     3     5     4     4 362  411    . 327</span></span>
<span><span class="co">#&gt;   Latvia      .   .     .     .     .     .     .     .   .    .    .   1</span></span>
<span><span class="co">#&gt;   Lithuania 125  43    14    14    14    12    14    14 187    8    . 172</span></span>
<span><span class="co">#&gt;   Norway      6   6     .     .     .     .     .     .   6    6    .   6</span></span>
<span><span class="co">#&gt;   Poland    136  10     .     .     .     .     .     .  43    .    .  43</span></span>
<span><span class="co">#&gt;   Russia      .  13     .     .     .     .     .     .   9    .    .   9</span></span>
<span><span class="co">#&gt;   Sweden    237  60    56    42    42    28    56    56 245  225  126 245</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     DRYWT% FLU HBCD HBCDA HBCDB HBCDG  LI LOIGN  PB TBSN+ TBTIN</span></span>
<span><span class="co">#&gt;   Denmark      481 448    .     .     .     . 469   515 482     .   402</span></span>
<span><span class="co">#&gt;   Estonia        2  28    .     .     .     .   .     .  28    28     .</span></span>
<span><span class="co">#&gt;   Finland        8  22    .     4     4     4   8     .  20    21     .</span></span>
<span><span class="co">#&gt;   Germany       15 127    .     .     .     . 233    70 367   102    34</span></span>
<span><span class="co">#&gt;   Latvia         .   .    .     .     .     .   .     .   1     .     .</span></span>
<span><span class="co">#&gt;   Lithuania      8  43    8     8     8     8   .     . 187     7     .</span></span>
<span><span class="co">#&gt;   Norway         .   6    .     .     .     .   6     .   6     .     .</span></span>
<span><span class="co">#&gt;   Poland       327  27    .     .     .     .   .   278  43     8     .</span></span>
<span><span class="co">#&gt;   Russia         .  13    .     .     .     .   .     .   9     .     .</span></span>
<span><span class="co">#&gt;   Sweden       255  60   14    14    14    14 139   108 245    56     4</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     1985 1990 1991 1993 1995 1996 1997 1998 1999 2000 2001 2002 2003</span></span>
<span><span class="co">#&gt;   Denmark     10    .  135    .    .    .    .    .  217  452  152    .  711</span></span>
<span><span class="co">#&gt;   Estonia      .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Finland      .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Germany      .    .    .  461    .    .    .   94   75  138   48  166   42</span></span>
<span><span class="co">#&gt;   Latvia       .    .    .    .    .    2    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Lithuania    .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Norway       .   48    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Poland       .    .    .    .    .    .    .    6    6   12    .   78   39</span></span>
<span><span class="co">#&gt;   Russia       .    .    .    .   10    .   35    8    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Sweden       .   28    .    .    .    .    .    .    .    .    4    .  196</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016</span></span>
<span><span class="co">#&gt;   Denmark     40    .    .  329 1221  328  121  351  360  351  451  209  175</span></span>
<span><span class="co">#&gt;   Estonia      .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Finland      .    .    .    .    .    .    .    .   28    .    .    4    .</span></span>
<span><span class="co">#&gt;   Germany    138   84   40   56  184   70  175  191  107   98   81    .  105</span></span>
<span><span class="co">#&gt;   Latvia       .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Lithuania   21    .    .   45   33   51   44   65   70   60   92  116   44</span></span>
<span><span class="co">#&gt;   Norway       .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Poland       .    .    .   95    .    .    .    .  189   27    .   56   80</span></span>
<span><span class="co">#&gt;   Russia       .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Sweden       .    .    5    .  238    .    .    5    .    .  859    .    .</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;   Denmark      .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Estonia     60   13  128   83  112</span></span>
<span><span class="co">#&gt;   Finland     42    .   68   31   38</span></span>
<span><span class="co">#&gt;   Germany     45   90    .   20    .</span></span>
<span><span class="co">#&gt;   Latvia       .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Lithuania   44   48   42  119    .</span></span>
<span><span class="co">#&gt;   Norway       .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Poland       .  174    .   35  118</span></span>
<span><span class="co">#&gt;   Russia       .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Sweden       .    .    .  910   96</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="organotins">Organotins<a class="anchor" aria-label="anchor" href="#organotins"></a>
</h4>
<p>Denmark, Germany and Sweden have submitted TBTIN data (as opposed to
TBSN+ data). TBTIN data are ambiguous and are no longer allowed. They
could represent the tin ion concentration or the trybutyltin cation
concentration. (TBSN+ is the cation concentration). Here is a more
detailed breakdown by year.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TBSN+"</span>, <span class="st">"TBTIN"</span><span class="op">)</span>,</span>
<span>    <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Denmark"</span>, <span class="st">"Germany"</span>, <span class="st">"Sweden"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>    </span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">year</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , country = Denmark</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 1990 1999 2000 2001 2002 2003 2004 2007 2008 2009 2010 2011 2012</span></span>
<span><span class="co">#&gt;       TBSN+    .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;       TBTIN    .   12   41   14    .   72    4    6   59   15    2   32   33</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2013 2014 2015 2016 2018 2020 2021</span></span>
<span><span class="co">#&gt;       TBSN+    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;       TBTIN   32   43   21   16    .    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Germany</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 1990 1999 2000 2001 2002 2003 2004 2007 2008 2009 2010 2011 2012</span></span>
<span><span class="co">#&gt;       TBSN+    .    .    .    .    .    .    .    .   16    7   18   12    9</span></span>
<span><span class="co">#&gt;       TBTIN    .    .   10    .   14    .   10    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2013 2014 2015 2016 2018 2020 2021</span></span>
<span><span class="co">#&gt;       TBSN+    8    2    .   10   15    5    .</span></span>
<span><span class="co">#&gt;       TBTIN    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Sweden</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 1990 1999 2000 2001 2002 2003 2004 2007 2008 2009 2010 2011 2012</span></span>
<span><span class="co">#&gt;       TBSN+    .    .    .    .    .   14    .    .   14    .    .    .    .</span></span>
<span><span class="co">#&gt;       TBTIN    4    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2013 2014 2015 2016 2018 2020 2021</span></span>
<span><span class="co">#&gt;       TBSN+    .   14    .    .    .    6    8</span></span>
<span><span class="co">#&gt;       TBTIN    .    .    .    .    .    .    .</span></span></code></pre></div>
<ul>
<li>
<strong>Sweden</strong>: the four TBTIN samples are from 1990 and
would drop out of the assessment anyway because there is too big a gap
until the next monitoring year in 2003 - they are deleted below to avoid
any ambiguity</li>
<li>
<strong>Germany</strong>: the 34 TBTIN samples are from 2000, 2002
and 2004 - they are all ‘old’ data, so they are deleted to avoid any
ambiguity</li>
<li>
<strong>Denmark</strong>: all the data are reported as TBTIN. These
are tin concentrations (Owen 22 August) so are converted to cation
concentrations below by multiplying by 2.44. Use the
<code>ctsm_TBT_convert</code> helper function to help with this.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"TBTIN"</span> <span class="op">&amp;</span> <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Germany"</span>, <span class="st">"Sweden"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_TBT_convert.html">ctsm_TBT_convert</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Denmark"</span>, </span>
<span>  action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"relabel"</span>, <span class="st">"convert"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="stations">Stations<a class="anchor" aria-label="anchor" href="#stations"></a>
</h3>
<div class="section level4">
<h4 id="germany-station-bmp-k4">Germany station BMP K4<a class="anchor" aria-label="anchor" href="#germany-station-bmp-k4"></a>
</h4>
<p>Data submitted as stations BMP K4 and OMBMPK4 should both be regarded
as BMP K4 (Berit, 6 October 2022). The submitted stations and the
resulting station names from the extraction procedure (based on
coordinates) are given below by year.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="va">submitted.station</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BMP K4"</span>, <span class="st">"OMBMPK4"</span><span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">station_name</span>, <span class="va">year</span>, <span class="va">submitted.station</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , submitted.station = BMP K4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             year</span></span>
<span><span class="co">#&gt; station_name 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2016</span></span>
<span><span class="co">#&gt;      BMP K4     .    .    .    .    .    .    .    .    9    3    9    .    6</span></span>
<span><span class="co">#&gt;      OMBMPK4    .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;             year</span></span>
<span><span class="co">#&gt; station_name 2017 2018 2020</span></span>
<span><span class="co">#&gt;      BMP K4     7    .    .</span></span>
<span><span class="co">#&gt;      OMBMPK4    .    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , submitted.station = OMBMPK4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             year</span></span>
<span><span class="co">#&gt; station_name 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2016</span></span>
<span><span class="co">#&gt;      BMP K4     .    .    .    7   10    8    8   14    8    .    .    9    .</span></span>
<span><span class="co">#&gt;      OMBMPK4    8   10   18    2    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;             year</span></span>
<span><span class="co">#&gt; station_name 2017 2018 2020</span></span>
<span><span class="co">#&gt;      BMP K4     .    .    .</span></span>
<span><span class="co">#&gt;      OMBMPK4    3    4    4</span></span></code></pre></div>
<p>There is the possibility of some duplication in 2011 and 2017 when
data were submitted as both BMP K4 and OMBPK4. Here are the determinands
submitted in each year. There is no duplication in 2017, but eight
values have been submitted twice in 2011. Delete the 2011 values from
OMBPK4 and then relabel OMBPK4 data as BMP K4</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2011</span>, <span class="fl">2017</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">submitted.station</span>, <span class="va">determinand</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , year = 2011</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  determinand</span></span>
<span><span class="co">#&gt; submitted.station AL ANT CD CORG CU FLU GSMF20 GSMF2000 LI PB</span></span>
<span><span class="co">#&gt;           BMP K4   1   1  1    2  1   1      .        .  1  1</span></span>
<span><span class="co">#&gt;           OMBMPK4  1   1  1    1  1   1      .        .  1  1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , year = 2017</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  determinand</span></span>
<span><span class="co">#&gt; submitted.station AL ANT CD CORG CU FLU GSMF20 GSMF2000 LI PB</span></span>
<span><span class="co">#&gt;           BMP K4   1   .  1    .  1   .      1        1  1  1</span></span>
<span><span class="co">#&gt;           OMBMPK4  .   1  .    1  .   1      .        .  .  .</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2011</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">submitted.station</span>, <span class="va">determinand</span>, <span class="va">matrix</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">determinand</span>, <span class="va">submitted.station</span><span class="op">)</span></span>
<span><span class="co">#&gt;    submitted.station determinand matrix     value</span></span>
<span><span class="co">#&gt; 1             BMP K4          AL  SED20    39.300</span></span>
<span><span class="co">#&gt; 2            OMBMPK4          AL  SED20    39.300</span></span>
<span><span class="co">#&gt; 3             BMP K4         ANT SEDTOT     1.057</span></span>
<span><span class="co">#&gt; 4            OMBMPK4         ANT SEDTOT     1.057</span></span>
<span><span class="co">#&gt; 5             BMP K4          CD  SED20   120.000</span></span>
<span><span class="co">#&gt; 6            OMBMPK4          CD  SED20   120.000</span></span>
<span><span class="co">#&gt; 7             BMP K4        CORG  SED20    58.400</span></span>
<span><span class="co">#&gt; 8             BMP K4        CORG SEDTOT    60.900</span></span>
<span><span class="co">#&gt; 9            OMBMPK4        CORG  SED20    58.400</span></span>
<span><span class="co">#&gt; 10            BMP K4          CU  SED20 41000.000</span></span>
<span><span class="co">#&gt; 11           OMBMPK4          CU  SED20 41000.000</span></span>
<span><span class="co">#&gt; 12            BMP K4         FLU SEDTOT     4.917</span></span>
<span><span class="co">#&gt; 13           OMBMPK4         FLU SEDTOT     4.917</span></span>
<span><span class="co">#&gt; 14            BMP K4          LI  SED20    41.000</span></span>
<span><span class="co">#&gt; 15           OMBMPK4          LI  SED20    41.000</span></span>
<span><span class="co">#&gt; 16            BMP K4          PB  SED20 79000.000</span></span>
<span><span class="co">#&gt; 17           OMBMPK4          PB  SED20 79000.000</span></span>
<span></span>
<span><span class="va">wk_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_station_code.html">get_station_code</a></span><span class="op">(</span><span class="st">"BMP K4"</span>, <span class="st">"Germany"</span>, <span class="va">sediment_data</span><span class="op">$</span><span class="va">stations</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span><span class="co">#&gt; ℹ In argument: `across(.fns = as.character)`.</span></span>
<span><span class="co">#&gt; Caused by warning:</span></span>
<span><span class="co">#&gt; ! Using `across()` without supplying `.cols` was deprecated in dplyr 1.1.0.</span></span>
<span><span class="co">#&gt; ℹ Please supply `.cols` instead.</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2011</span> <span class="op">&amp;</span> <span class="va">submitted.station</span> <span class="op">==</span> <span class="st">"OMBMPK4"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    .change <span class="op">=</span> <span class="va">submitted.station</span> <span class="op">==</span> <span class="st">"OMBMPK4"</span>,</span>
<span>    station_name <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.change</span>, <span class="st">"BMP K4"</span>, <span class="va">station_name</span><span class="op">)</span>,</span>
<span>    station_code <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.change</span>, <span class="va">wk_code</span>, <span class="va">station_code</span><span class="op">)</span>,</span>
<span>    .change <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="matrix-issues-1">Matrix issues<a class="anchor" aria-label="anchor" href="#matrix-issues-1"></a>
</h4>
<p>Here is a summary of matrix submissions by country. To focus on
‘relevant’ data, only stations that have been monitored in the last six
monitoring years (2016-2021) have been considered. Grain size fraction
data have also been omitted. Only Germany and Poland have submitted in
multiple matrices and it is worth investigating what is going on. Note
that SED62 is treated as SED63 in the code; similarly SED2000 is treated
as SEDTOT.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span>, </span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"GSMF"</span>, <span class="va">determinand</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span>  </span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">matrix</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;          country</span></span>
<span><span class="co">#&gt; matrix    Denmark Estonia Finland Germany Lithuania Poland Sweden</span></span>
<span><span class="co">#&gt;   SED20         .       .       .     849         .      .      .</span></span>
<span><span class="co">#&gt;   SED2000     247       .       .     229         .     12      .</span></span>
<span><span class="co">#&gt;   SED62         .       .       .       .         .      1      .</span></span>
<span><span class="co">#&gt;   SED63         .       .       .      82         .    838   2294</span></span>
<span><span class="co">#&gt;   SEDTOT        .     396     183     213       787      .      .</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="poland">Poland<a class="anchor" aria-label="anchor" href="#poland"></a>
</h4>
<p>All SED2000 data are from 2000 or earlier, so they are deleted to
avoid confusion with the SED63 (or SED62) data.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Poland"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">matrix</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;          year</span></span>
<span><span class="co">#&gt; matrix    1998 1999 2000 2002 2003 2007 2012 2013 2015 2016 2018 2020 2021</span></span>
<span><span class="co">#&gt;   SED2000    6    3    3    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   SED62      .    .    .    1    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   SED63      .    .    .   51   13   95  189   27   56   80  174   35  118</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>,  </span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Poland"</span> <span class="op">&amp;</span> <span class="va">matrix</span> <span class="op">==</span> <span class="st">"SED2000"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="germany">Germany<a class="anchor" aria-label="anchor" href="#germany"></a>
</h4>
<p>Here is a summary of German data by matrix. All organics (apart from
three TBSN+ samples) are measured in SED2000 (or SEDTOT). The metals are
measured in SED20, SED63 or SED2000.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wk</span>, <span class="va">country</span> <span class="op">==</span> <span class="st">"Germany"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            matrix</span></span>
<span><span class="co">#&gt; determinand SED20 SED2000 SED63 SEDTOT</span></span>
<span><span class="co">#&gt;      AL       148       3     .      .</span></span>
<span><span class="co">#&gt;      ANT        .      47     .     58</span></span>
<span><span class="co">#&gt;      BD100      .       3     .      .</span></span>
<span><span class="co">#&gt;      BD153      .       3     .      .</span></span>
<span><span class="co">#&gt;      BD154      .       3     .      .</span></span>
<span><span class="co">#&gt;      BDE28      .       4     .      .</span></span>
<span><span class="co">#&gt;      BDE47      .       3     .      .</span></span>
<span><span class="co">#&gt;      BDE99      .       3     .      .</span></span>
<span><span class="co">#&gt;      CD       147       3    38      .</span></span>
<span><span class="co">#&gt;      CORG     134      33     3     61</span></span>
<span><span class="co">#&gt;      CU       147       3     .      .</span></span>
<span><span class="co">#&gt;      DRYWT%     .       .     .     15</span></span>
<span><span class="co">#&gt;      FLU        .      44     .     59</span></span>
<span><span class="co">#&gt;      LI        97       3     .      .</span></span>
<span><span class="co">#&gt;      LOIGN     30      30     .     10</span></span>
<span><span class="co">#&gt;      PB       146       3    38      .</span></span>
<span><span class="co">#&gt;      TBSN+      .      41     3     10</span></span></code></pre></div>
<p>The three TBSN+ samples in SED63 are the only TBSN+ data from station
OMBMPK8 and were last sampled in 2012, so we don’t need to worry about
them. Here is a summary of the TBSN+ submissions from stations where
SDE63 has been used.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"TBSN+"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"SED63"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">matrix</span>, <span class="va">year</span>, <span class="va">station_name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , station_name = OMBMPK8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        year</span></span>
<span><span class="co">#&gt; matrix  2009 2011 2012</span></span>
<span><span class="co">#&gt;   SED63    1    1    1</span></span></code></pre></div>
<p>Here is a summary of matrix sumbissions for the metals by station and
matrix. Most of the data are in SED20.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    .id <span class="op">=</span> <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Germany"</span> <span class="op">&amp;</span> <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD"</span>, <span class="st">"PB"</span>, <span class="st">"CU"</span><span class="op">)</span>, </span>
<span>    .recent <span class="op">=</span> <span class="va">station_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk</span><span class="op">$</span><span class="va">station_name</span>,</span>
<span>    .target_matrix <span class="op">=</span> <span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"SED20"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">unite</span><span class="op">(</span><span class="st">".sample"</span>, <span class="va">sample</span>, <span class="va">determinand</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">.recent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">station_name</span>, <span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;             matrix</span></span>
<span><span class="co">#&gt; station_name SED20 SED2000 SED63</span></span>
<span><span class="co">#&gt;     BMP K4      42       .     .</span></span>
<span><span class="co">#&gt;     Oderbank    12       .     .</span></span>
<span><span class="co">#&gt;     OM225027    15       .     8</span></span>
<span><span class="co">#&gt;     OM225054     .       .     2</span></span>
<span><span class="co">#&gt;     OM225059    15       .     8</span></span>
<span><span class="co">#&gt;     OM701       15       .     8</span></span>
<span><span class="co">#&gt;     OM708       15       .     8</span></span>
<span><span class="co">#&gt;     OM714       15       .     8</span></span>
<span><span class="co">#&gt;     OMBMPK7     55       3     .</span></span>
<span><span class="co">#&gt;     OMBMPK8     58       3     .</span></span>
<span><span class="co">#&gt;     OMBMPM2     63       3     .</span></span>
<span><span class="co">#&gt;     OMBMPN1     30       .     .</span></span>
<span><span class="co">#&gt;     OMBMPN3     30       .     .</span></span>
<span><span class="co">#&gt;     OMF1        15       .     8</span></span>
<span><span class="co">#&gt;     OMMB3       15       .     8</span></span>
<span><span class="co">#&gt;     OMMB6       15       .     6</span></span>
<span><span class="co">#&gt;     OMS2        15       .     6</span></span>
<span><span class="co">#&gt;     OMS3        15       .     6</span></span></code></pre></div>
<p>It turns out that the SED2000 measurements are ‘replicates’ in the
sense that the same samples already have SED20 measurements. Since SED20
appears to be the target matrix, it makes sense to delete the SED2000
measurements. Here is what is left.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wk_sample</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">.target_matrix</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">.sample</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">.sample</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_sample</span> <span class="op">&amp;</span> <span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"SED2000"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">.recent</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">station_name</span>, <span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;             matrix</span></span>
<span><span class="co">#&gt; station_name SED20 SED63</span></span>
<span><span class="co">#&gt;     BMP K4      42     .</span></span>
<span><span class="co">#&gt;     Oderbank    12     .</span></span>
<span><span class="co">#&gt;     OM225027    15     8</span></span>
<span><span class="co">#&gt;     OM225054     .     2</span></span>
<span><span class="co">#&gt;     OM225059    15     8</span></span>
<span><span class="co">#&gt;     OM701       15     8</span></span>
<span><span class="co">#&gt;     OM708       15     8</span></span>
<span><span class="co">#&gt;     OM714       15     8</span></span>
<span><span class="co">#&gt;     OMBMPK7     55     .</span></span>
<span><span class="co">#&gt;     OMBMPK8     58     .</span></span>
<span><span class="co">#&gt;     OMBMPM2     63     .</span></span>
<span><span class="co">#&gt;     OMBMPN1     30     .</span></span>
<span><span class="co">#&gt;     OMBMPN3     30     .</span></span>
<span><span class="co">#&gt;     OMF1        15     8</span></span>
<span><span class="co">#&gt;     OMMB3       15     8</span></span>
<span><span class="co">#&gt;     OMMB6       15     6</span></span>
<span><span class="co">#&gt;     OMS2        15     6</span></span>
<span><span class="co">#&gt;     OMS3        15     6</span></span></code></pre></div>
<p>There appears to have been a change in strategy at some stations,
switching to SED63 in 2012. Here are the matrix records for those
stations where metals have been sampled in both SED20 and SED63.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">.recent</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SED63"</span>, <span class="st">"SED20"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">.recent</span> <span class="op">&amp;</span> <span class="va">station_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">matrix</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;        year</span></span>
<span><span class="co">#&gt; matrix  2000 2002 2004 2008 2010 2012 2014 2016 2018</span></span>
<span><span class="co">#&gt;   SED20   30   30   30   30   30    .    .    .    .</span></span>
<span><span class="co">#&gt;   SED63    .    .    .    .    .   20   16   18   20</span></span></code></pre></div>
<p>To ensure the time series have a consistent matrix, the SED20 records
from these stations from before 2012 are deleted.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">station_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span> <span class="op">&amp;</span> <span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"SED20"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    .id <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>    .recent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    .sample <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    .target_matrix <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sbde6">SBDE6<a class="anchor" aria-label="anchor" href="#sbde6"></a>
</h4>
<p>For info, here are the PBDE measurements by country (again filtered
on stations that have been monitored in the last six years). When
constructing the sum of the six PBDEs, we will lose the following data
due to incomplete submissions: 2012 data from Lithuania (no BDE28) and
2003 and 2008 data from Sweden. (Note that HOLAS 2 required all six
PBDEs to be present, although it turned out that no sample had a
corresponding organic carbon measurement, so all the data dropped out
anyway.)</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"BD"</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">year</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , country = Estonia</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2003 2008 2012 2014 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    .    .    .    5    1    9    7    8</span></span>
<span><span class="co">#&gt;       BD153    .    .    .    .    5    1    9    7    8</span></span>
<span><span class="co">#&gt;       BD154    .    .    .    .    5    1    9    7    8</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    .    5    1    9    7    8</span></span>
<span><span class="co">#&gt;       BDE47    .    .    .    .    5    1    9    7    8</span></span>
<span><span class="co">#&gt;       BDE99    .    .    .    .    5    1    9    7    8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Finland</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2003 2008 2012 2014 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    .    .    .    .    .    4    2    3</span></span>
<span><span class="co">#&gt;       BD153    .    .    .    .    .    .    4    2    3</span></span>
<span><span class="co">#&gt;       BD154    .    .    .    .    .    .    4    2    3</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    .    .    .    4    2    3</span></span>
<span><span class="co">#&gt;       BDE47    .    .    .    .    .    .    4    2    3</span></span>
<span><span class="co">#&gt;       BDE99    .    .    .    .    .    .    4    2    3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Lithuania</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2003 2008 2012 2014 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    .    2    3    .    .    .    8    .</span></span>
<span><span class="co">#&gt;       BD153    .    .    2    3    .    .    .    8    .</span></span>
<span><span class="co">#&gt;       BD154    .    .    2    3    .    .    .    8    .</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    3    .    .    .    8    .</span></span>
<span><span class="co">#&gt;       BDE47    .    .    2    3    .    .    .    8    .</span></span>
<span><span class="co">#&gt;       BDE99    .    .    2    3    .    .    .    8    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Sweden</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2003 2008 2012 2014 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100   14   14    .   14    .    .    .    6    8</span></span>
<span><span class="co">#&gt;       BD153    .   14    .   14    .    .    .    6    8</span></span>
<span><span class="co">#&gt;       BD154    .   14    .   14    .    .    .    6    8</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .   14    .    .    .    6    8</span></span>
<span><span class="co">#&gt;       BDE47   14   14    .   14    .    .    .    6    8</span></span>
<span><span class="co">#&gt;       BDE99   14   14    .   14    .    .    .    6    8</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="basis">Basis<a class="anchor" aria-label="anchor" href="#basis"></a>
</h4>
<p>Here is the basis of submissions (apart from grain size fractions and
drywt%).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"GSMF"</span>, <span class="va">determinand</span><span class="op">)</span>, </span>
<span>    <span class="va">determinand</span> <span class="op">!=</span> <span class="st">"DRYWT%"</span>, </span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">basis</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            basis</span></span>
<span><span class="co">#&gt; country        D    W</span></span>
<span><span class="co">#&gt;   Denmark    227    .</span></span>
<span><span class="co">#&gt;   Estonia    394    .</span></span>
<span><span class="co">#&gt;   Finland    169    6</span></span>
<span><span class="co">#&gt;   Germany   1199    .</span></span>
<span><span class="co">#&gt;   Lithuania  748   33</span></span>
<span><span class="co">#&gt;   Poland     532    .</span></span>
<span><span class="co">#&gt;   Sweden    2043    .</span></span></code></pre></div>
<p>Wet weight submissions are unusual. The Lithuanian submissions have
been confirmed as correct (Nijole, 19 August 2022). The Finnish
submissions should be dry weight (Emmi, 16 August 2022) and this is
corrected below.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">basis</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">year</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , country = Finland</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2015 2020</span></span>
<span><span class="co">#&gt;       CD       .    3</span></span>
<span><span class="co">#&gt;       CORG     .    .</span></span>
<span><span class="co">#&gt;       HBCD     .    .</span></span>
<span><span class="co">#&gt;       HBCDA    .    .</span></span>
<span><span class="co">#&gt;       HBCDB    .    .</span></span>
<span><span class="co">#&gt;       HBCDG    .    .</span></span>
<span><span class="co">#&gt;       PB       .    3</span></span>
<span><span class="co">#&gt;       TBSN+    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Lithuania</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2015 2020</span></span>
<span><span class="co">#&gt;       CD       .    .</span></span>
<span><span class="co">#&gt;       CORG     6    .</span></span>
<span><span class="co">#&gt;       HBCD     6    .</span></span>
<span><span class="co">#&gt;       HBCDA    6    .</span></span>
<span><span class="co">#&gt;       HBCDB    6    .</span></span>
<span><span class="co">#&gt;       HBCDG    6    .</span></span>
<span><span class="co">#&gt;       PB       .    .</span></span>
<span><span class="co">#&gt;       TBSN+    3    .</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  .id <span class="op">=</span> <span class="va">basis</span> <span class="op">==</span> <span class="st">"W"</span> <span class="op">&amp;</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Finland"</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">.id</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"something has changed - investigate"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  basis <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.id</span>, <span class="st">"D"</span>, <span class="va">basis</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="poland---multiple-depths">Poland - multiple depths<a class="anchor" aria-label="anchor" href="#poland---multiple-depths"></a>
</h4>
<p>Poland have analysed auxiliary data (AL, DRYWT% and LOIGN) at
multiple depths. Just retain the surface measurements for compatibility
with the contaminant measurements.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Poland"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">depth</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            depth</span></span>
<span><span class="co">#&gt; determinand  0 0.01 0.02 0.03 0.04 0.06 0.08 0.15 0.22 0.29</span></span>
<span><span class="co">#&gt;      AL     17    .   17    .   17   17   17   17   17   17</span></span>
<span><span class="co">#&gt;      ANT    10    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      CD     35    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      CU     35    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      DRYWT% 48   10   48   10   48   38   38   29   29   29</span></span>
<span><span class="co">#&gt;      FLU    27    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      LOIGN  40    5   40    5   40   35   35   26   26   26</span></span>
<span><span class="co">#&gt;      PB     35    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;      TBSN+   8    .    .    .    .    .    .    .    .    .</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Poland"</span> <span class="op">&amp;</span> <span class="va">depth</span> <span class="op">&gt;=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="normalisers">Normalisers<a class="anchor" aria-label="anchor" href="#normalisers"></a>
</h3>
<div class="section level5">
<h5 id="aluminium">Aluminium<a class="anchor" aria-label="anchor" href="#aluminium"></a>
</h5>
<p>Here is a plot of the aluminium concentrations (%) in ‘relevant’ time
series by year and country. Most values seem broadly compatible with
normalising to 5% aluminium. However, the values from Lithuania and
Estonia are suspiciously small and worth looking at in more detail.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AL"</span>, <span class="st">"CORG"</span>, <span class="st">"LOIGN"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="../reference/convert_units.html">convert_units</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">value</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">country</span>, </span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">wk</span>, <span class="va">determinand</span> <span class="op">==</span> <span class="st">"AL"</span><span class="op">)</span>, </span>
<span>  col <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/helcom-data-adjust-sed_AL1-1.png" alt=""><p class="caption">plot of chunk helcom-data-adjust-sed_AL1</p>
</div>
<p>Here are the Lithuanian aluminium measurements on their own. They
have been confirmed correct (Nijole, 19 August 2022) but are mostly
lower than the values you would find in pure sand (even with a weak
digestion method).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wk</span>, <span class="va">determinand</span> <span class="op">==</span> <span class="st">"AL"</span> <span class="op">&amp;</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Lithuania"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">value</span> <span class="op">~</span> <span class="va">year</span>, </span>
<span>  data <span class="op">=</span> <span class="va">wk1</span>, </span>
<span>  col <span class="op">=</span> <span class="st">"black"</span>, </span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/helcom-data-adjust-sed_AL2-1.png" alt=""><p class="caption">plot of chunk helcom-data-adjust-sed_AL2</p>
</div>
<p>Here are the Estonian aluminium measurements. They are low relative
to other countries, but not as pronounced as for Lithuania. The
corresponding organic carbon measurements are also very low, so they are
probably monitoring very sandy sediments without sieving.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wk</span>, <span class="va">determinand</span> <span class="op">==</span> <span class="st">"AL"</span> <span class="op">&amp;</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Estonia"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">value</span> <span class="op">~</span> <span class="va">year</span>, </span>
<span>  data <span class="op">=</span> <span class="va">wk1</span>, </span>
<span>  col <span class="op">=</span> <span class="st">"black"</span>, </span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/helcom-data-adjust-sed_AL3-1.png" alt=""><p class="caption">plot of chunk helcom-data-adjust-sed_AL3</p>
</div>
</div>
<div class="section level4">
<h4 id="corg-loign">CORG / LOIGN<a class="anchor" aria-label="anchor" href="#corg-loign"></a>
</h4>
<p>Here is a plot of the CORG (blue) and LOIGN (purple) concentrations
(%) in ‘relevant’ time series by year and country. LOIGN will be used
for normalising whenever CORG is not available. Assuming CORG = 0.35
<span class="math inline">\(\times\)</span> LOIGN (Owen, 17 August 2022)
then normalising to 5% CORG is equivalent to normalising to 14.3%
LOIGN.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">value</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">country</span>, </span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">wk</span>, <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CORG"</span>, <span class="st">"LOIGN"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  groups <span class="op">=</span> <span class="va">determinand</span>,</span>
<span>  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/helcom-data-adjust-sed_corg-1.png" alt=""><p class="caption">plot of chunk helcom-data-adjust-sed_corg</p>
</div>
<p>Here is a plot of the CORG values on their own, without the
distortion caused by the LOIGN values. The values for Estonia are nearly
all less-thans (&lt;0.1%) which supports the interpretation that their
sediments are nearly pure sand.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"CORG"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="../reference/convert_units.html">convert_units</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">value</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">country</span>, </span>
<span>  data <span class="op">=</span> <span class="va">wk</span>, </span>
<span>  col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/helcom-data-adjust-sed_corg2-1.png" alt=""><p class="caption">plot of chunk helcom-data-adjust-sed_corg2</p>
</div>
</div>
<div class="section level4">
<h4 id="sweden---missing-corg">Sweden - missing CORG<a class="anchor" aria-label="anchor" href="#sweden---missing-corg"></a>
</h4>
<p>Sweden is missing CORG from sediment samples in 2020 and 2021 in
which organic contaminants were measured. Apparently, the samples were
damaged / lost before CORG could be measured. For 2021, values are
provided by Johan (3 October 2022) based on new samples taken at the
same locations. Here are the 2021 samples in the extraction:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Sweden"</span>, </span>
<span>    <span class="va">year</span> <span class="op">==</span> <span class="fl">2021</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;          determinand</span></span>
<span><span class="co">#&gt; sample    ANT BD100 BD153 BD154 BDE28 BDE47 BDE99 FLU HBCDA HBCDB HBCDG TBSN+</span></span>
<span><span class="co">#&gt;   3624467   1     1     1     1     1     1     1   1     1     1     1     1</span></span>
<span><span class="co">#&gt;   3624468   1     1     1     1     1     1     1   1     1     1     1     1</span></span>
<span><span class="co">#&gt;   3624469   1     1     1     1     1     1     1   1     1     1     1     1</span></span>
<span><span class="co">#&gt;   3624470   1     1     1     1     1     1     1   1     1     1     1     1</span></span>
<span><span class="co">#&gt;   3624471   1     1     1     1     1     1     1   1     1     1     1     1</span></span>
<span><span class="co">#&gt;   3624472   1     1     1     1     1     1     1   1     1     1     1     1</span></span>
<span><span class="co">#&gt;   3624473   1     1     1     1     1     1     1   1     1     1     1     1</span></span>
<span><span class="co">#&gt;   3624476   1     1     1     1     1     1     1   1     1     1     1     1</span></span></code></pre></div>
<p>Next, let’s find out whether we’re using an “old” or “new” data
format, and store that in a variable so we can use it.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># By default, set a format flag to "old"</span></span>
<span><span class="va">wk_data_format</span> <span class="op">&lt;-</span> <span class="st">"old"</span></span>
<span></span>
<span><span class="co"># Overwrite this value if a format was specified in the call</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">sediment_data</span><span class="op">$</span><span class="va">call</span><span class="op">$</span><span class="va">data_format</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">wk_data_format</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">call</span><span class="op">$</span><span class="va">data_format</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>And here are the values of CORG provided by Johan, which are merged
with the main data set.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_new</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"data"</span>, <span class="st">"example_HELCOM"</span>, <span class="st">"SE_missing_CORG_sediment.csv"</span><span class="op">)</span>,</span>
<span>    na.string <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">tblSampleID</span>, <span class="va">Value</span>, <span class="va">MUNIT</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_new</span></span>
<span><span class="co">#&gt;   tblSampleID Value MUNIT</span></span>
<span><span class="co">#&gt; 1     3624469 12.27     %</span></span>
<span><span class="co">#&gt; 2     3624467  5.79     %</span></span>
<span><span class="co">#&gt; 3     3624468  6.08     %</span></span>
<span><span class="co">#&gt; 4     3624476  2.42     %</span></span>
<span><span class="co">#&gt; 5     3624471 12.37     %</span></span>
<span><span class="co">#&gt; 6     3624470 11.41     %</span></span>
<span><span class="co">#&gt; 7     3624473 14.02     %</span></span>
<span><span class="co">#&gt; 8     3624472 11.48     %</span></span>
<span></span>
<span><span class="va">wk_new</span> <span class="op">&lt;-</span> <span class="va">wk_new</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span> <span class="va">MUNIT</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>tblSampleID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">tblSampleID</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="va">determinand</span> <span class="op">==</span> <span class="st">"ANT"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">wk_data</span>, <span class="va">wk_new</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sample"</span> <span class="op">=</span> <span class="st">"tblSampleID"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">wk_data</span>,</span>
<span>  indicator <span class="op">=</span> <span class="st">"Supplemental"</span>,</span>
<span>  pargroup <span class="op">=</span> <span class="st">"O-MAJ"</span>,</span>
<span>  determinand <span class="op">=</span> <span class="st">"CORG"</span>,</span>
<span>  value <span class="op">=</span> <span class="va">Value</span>,</span>
<span>  unit <span class="op">=</span> <span class="st">"%"</span>,</span>
<span>  censoring <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  method_analysis <span class="op">=</span> <span class="cn">NA_character_</span>,</span>
<span>  limit_detection <span class="op">=</span> <span class="cn">NA_real_</span>,</span>
<span>  limit_quantification <span class="op">=</span> <span class="cn">NA_real_</span>, </span>
<span>  uncertainty <span class="op">=</span> <span class="cn">NA_real_</span>, </span>
<span>  unit_uncertainty <span class="op">=</span> <span class="cn">NA_character_</span>, </span>
<span>  alabo <span class="op">=</span> <span class="st">"NSLS"</span>,</span>
<span>  qalink <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  replicate <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wk_data</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">replicate</span><span class="op">)</span>,</span>
<span>  Value <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">wk_data_format</span> <span class="op">==</span> <span class="st">"new"</span><span class="op">)</span> <span class="va">wk_data</span><span class="op">$</span><span class="va">indicator</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>, <span class="va">wk_data</span><span class="op">)</span></span></code></pre></div>
<p>In 2020, some samples have supporting CORG and others don’t. Here are
the number of samples by station, and the corresponding number of CORG
measurements. (At some stations there are replicate measurements in the
same sample.) The ‘missing’ CORG values are taken to be the median CORG
measurement from the station.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="va">country</span> <span class="op">==</span> <span class="st">"Sweden"</span>,</span>
<span>  <span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n_sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span>, n_CORG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"CORG"</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    station_name n_sample n_CORG</span></span>
<span><span class="co">#&gt; 1          SE-1        9      5</span></span>
<span><span class="co">#&gt; 2         SE-10        8      5</span></span>
<span><span class="co">#&gt; 3         SE-11        8      5</span></span>
<span><span class="co">#&gt; 4         SE-12        8      9</span></span>
<span><span class="co">#&gt; 5         SE-13        8      5</span></span>
<span><span class="co">#&gt; 6         SE-17        9      5</span></span>
<span><span class="co">#&gt; 7          SE-2        9      5</span></span>
<span><span class="co">#&gt; 8          SE-3        9      5</span></span>
<span><span class="co">#&gt; 9          SE-4        9      5</span></span>
<span><span class="co">#&gt; 10         SE-5        9      9</span></span>
<span><span class="co">#&gt; 11         SE-6        7      5</span></span>
<span><span class="co">#&gt; 12         SE-7        8      5</span></span>
<span><span class="co">#&gt; 13         SE-8        8      5</span></span>
<span><span class="co">#&gt; 14         SE-9        8      5</span></span>
<span></span>
<span><span class="va">wk_CORG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"CORG"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># identify samples in wk_data with no CORG</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="va">wk_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">sample</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_CORG</span><span class="op">$</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">sample</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_CORG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/by.html" class="external-link">by</a></span><span class="op">(</span><span class="va">wk_CORG</span>, <span class="va">wk_CORG</span><span class="op">$</span><span class="va">station_name</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">arrange</span><span class="op">(</span><span class="va">x</span>, <span class="va">value</span><span class="op">)</span></span>
<span>  <span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">id</span>, <span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_CORG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">wk_CORG</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"pargroup"</span>, <span class="st">"determinand"</span>, <span class="st">"basis"</span>, <span class="st">"unit"</span>,</span>
<span>  <span class="st">"value"</span>, <span class="st">"censoring"</span>, <span class="st">"limit_detection"</span>, <span class="st">"limit_quantification"</span>, <span class="st">"uncertainty"</span>,</span>
<span>  <span class="st">"unit_uncertainty"</span>, <span class="st">"alabo"</span>, <span class="st">"method_analysis"</span>, <span class="st">"smtyp"</span>, <span class="st">"qalink"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">wk_data_format</span> <span class="op">==</span> <span class="st">"old"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">wk_id</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"indicator"</span>, <span class="st">"ges_matrix"</span><span class="op">)</span>, after <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">wk_data</span><span class="op">[</span>, <span class="va">wk_id</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">wk_CORG</span><span class="op">[</span><span class="va">wk_data</span><span class="op">$</span><span class="va">station_name</span>, <span class="va">wk_id</span><span class="op">]</span></span>
<span></span>
<span><span class="va">wk_data</span><span class="op">$</span><span class="va">replicate</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wk_data</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">replicate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span>, <span class="va">wk_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="va">wk_CORG</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="multiple-method_extraction">Multiple method_extraction<a class="anchor" aria-label="anchor" href="#multiple-method_extraction"></a>
</h4>
<p>There are a few instances of multiple method_extraction for sediment
in the QA file. These are unusual. If they are single methods, new
method_extraction codes should be set up. Unfortunately, the R code
can’t currently deal with them, so we have to modify them sensibly. Here
are the methods and the determinands they are used for (relevant to the
HELCOM assessment)</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">QA</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">data_type</span> <span class="op">==</span> <span class="st">"CS"</span>,</span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/ctsm_get_determinands.html">ctsm_get_determinands</a></span><span class="op">(</span><span class="st">"sediment"</span><span class="op">)</span>,</span>
<span>      <span class="st">"BDE28"</span>, <span class="st">"BDE47"</span>, <span class="st">"BDE99"</span>, <span class="st">"BD100"</span>, <span class="st">"BD153"</span>, <span class="st">"BD154"</span>, <span class="st">"HBCDA"</span>, <span class="st">"HBCDB"</span>, <span class="st">"HBCDG"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"~"</span>, <span class="va">method_extraction</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">method_extraction</span>, <span class="va">determinand</span>, <span class="va">alabo</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">method_extraction</span>, <span class="va">alabo</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">method_extraction</span>, <span class="va">alabo</span>, <span class="va">determinand</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="va">DT_options</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Fortunately, most of these are for organics, for which
method_extraction isn’t used. So replace e.g. <code>ACH~PLE</code> by
<code>ACE</code> etc.</p>
<p><code>HNO-CM~LMF-A-L</code> is more problematic, because it is for
metals and is a combination of a strong and a total digestion method,
which doesn’t make sense. Fortunately, it doesn’t matter because the
only time series with metals data analysed by this method finished in
2014 (see below). So we can replace this code by <code>HNO-CM</code>
without it having any impact on the assessment.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">QA</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">QA</span>,</span>
<span>  method_extraction <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span></span>
<span>    <span class="va">method_extraction</span>,</span>
<span>    <span class="st">"ACH~PLE"</span> <span class="op">=</span> <span class="st">"ACH"</span>,</span>
<span>    <span class="st">"ACE~PLE~TOL"</span> <span class="op">=</span> <span class="st">"ACE"</span>,</span>
<span>    <span class="st">"DCM~METH"</span> <span class="op">=</span> <span class="st">"DCM"</span>,</span>
<span>    <span class="st">"HAC~METH"</span> <span class="op">=</span> <span class="st">"HAC"</span>,</span>
<span>    <span class="st">"HX~SPE-DCM~PLE"</span> <span class="op">=</span> <span class="st">"HX"</span>,</span>
<span>    <span class="st">"SOX~TOL"</span> <span class="op">=</span> <span class="st">"SOX"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">QA</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">data_type</span> <span class="op">==</span> <span class="st">"CS"</span>, </span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD"</span>, <span class="st">"HG"</span>, <span class="st">"CU"</span><span class="op">)</span>,</span>
<span>    <span class="va">method_extraction</span> <span class="op">==</span> <span class="st">"HNO-CM~LMF-A-L"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">alabo</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span><span class="va">.id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">.id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">unite</span><span class="op">(</span><span class="st">".id"</span>, <span class="va">alabo</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">station_code</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD"</span>, <span class="st">"PB"</span>, <span class="st">"CU"</span><span class="op">)</span>,</span>
<span>    <span class="va">station_code</span> <span class="op">==</span> <span class="fl">11167</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">country</span>, <span class="va">station_code</span>, <span class="va">station_name</span>, <span class="va">alabo</span>, <span class="va">determinand</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sediment_data</span><span class="op">$</span><span class="va">QA</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span><span class="op">$</span><span class="va">QA</span>,</span>
<span>  method_extraction <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">method_extraction</span>, <span class="st">"HNO-CM~LMF-A-L"</span> <span class="op">=</span> <span class="st">"HNO-CM"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="missing-uncertainties-loign">Missing uncertainties LOIGN<a class="anchor" aria-label="anchor" href="#missing-uncertainties-loign"></a>
</h4>
<p>Missing uncertainties for all determinands other than LOIGN are
imputed using the fixed and relative standard deviations derived for the
OSPAR 2022 assessment. Fixed and relative standard deviations for LOIGN
need to be estimated from the HELCOM data (because LOIGN was not used in
the OSPAR 2022 assessment). Here is a plot of the relative uncertainties
for LOIGN that have been reported, by country. (Some very large Danish
uncertainties have been omitted - these are probably due to unit
errors.)</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">sediment_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"LOIGN"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="fu"><a href="../reference/convert_units.html">convert_units</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span>, <span class="st">"%"</span><span class="op">)</span>,</span>
<span>    uncertainty <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">unit_uncertainty</span> <span class="op">==</span> <span class="st">"U2"</span> <span class="op">~</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">uncertainty</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">value</span>,</span>
<span>      <span class="va">unit_uncertainty</span> <span class="op">==</span> <span class="st">"SD"</span> <span class="op">~</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">uncertainty</span> <span class="op">/</span> <span class="va">value</span>,</span>
<span>      <span class="cn">TRUE</span>                      <span class="op">~</span> <span class="va">uncertainty</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uncertainty <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">uncertainty</span> <span class="op">&gt;=</span> <span class="fl">100</span>, <span class="cn">NA_real_</span>, <span class="va">uncertainty</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="va">uncertainty</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">uncertainty</span> <span class="op">~</span> <span class="va">value</span> <span class="op">|</span> <span class="va">country</span>,</span>
<span>  data <span class="op">=</span> <span class="va">wk</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"relative uncertainty (%)"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"concentration (%)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/helcom-data-adjust-sed_uncrt1-1.png" alt=""><p class="caption">plot of chunk helcom-data-adjust-sed_uncrt1</p>
</div>
<p>The relative standard deviations is estimated using the same
procedures as used by OSPAR, and gives a value of 0.1 (10%). The
constant standard deviation is set to 0 (because there are hardly any
less-than measurements on which to base it).</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_relative</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">censoring</span><span class="op">)</span>,</span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">alabo</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">determinand</span>, <span class="va">.data</span><span class="op">$</span><span class="va">alabo</span>, <span class="va">.data</span><span class="op">$</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>sd_variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">uncertainty</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now the median value across alabos</span></span>
<span><span class="va">out_relative</span> <span class="op">&lt;-</span> <span class="fu">summarise</span><span class="op">(</span><span class="va">out_relative</span>, sd_variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">sd_variable</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="biota">Biota<a class="anchor" aria-label="anchor" href="#biota"></a>
</h3>
<div class="section level4">
<h4 id="data-summary-2">Data summary<a class="anchor" aria-label="anchor" href="#data-summary-2"></a>
</h4>
<p>Here is a summary of the submissions for each country, first by
determinand and then by year. Some of the less useful supporting data
have been omitted for simplicity (as have the four UK records from
1999).</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"TIN"</span>, <span class="va">determinand</span><span class="op">)</span>,</span>
<span>  <span class="va">determinand</span> <span class="op">!=</span> <span class="st">"IMPF%"</span>,</span>
<span>  <span class="va">country</span> <span class="op">!=</span> <span class="st">"United Kingdom"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     %FEMALEPOP   BAP BD100 BD153 BD154 BDE28 BDE47 BDE99 BR-PFOS CB101</span></span>
<span><span class="co">#&gt;   Denmark            .  1012   124   123   124    88   107   119       .   519</span></span>
<span><span class="co">#&gt;   Estonia            .     .    27    27    27    27    27    27       .   210</span></span>
<span><span class="co">#&gt;   Finland            .     .   134   134   134   134   134   134       .   749</span></span>
<span><span class="co">#&gt;   Germany            .   156   353   314   367   355   358   367       .   569</span></span>
<span><span class="co">#&gt;   Latvia             .     .     6     6     6     6     6     6       .     9</span></span>
<span><span class="co">#&gt;   Lithuania          .     4    12    12    12    12    12    12       .     .</span></span>
<span><span class="co">#&gt;   Poland             .    18   620   620   620   620   620   620       .  1152</span></span>
<span><span class="co">#&gt;   Sweden           298    31  1103  1078   467   470  2011  1997     282  2783</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     CB105 CB110 CB114 CB118 CB122 CB123 CB126 CB128 CB138 CB138+163</span></span>
<span><span class="co">#&gt;   Denmark     522   294    38   513     .    38    88   425   520         .</span></span>
<span><span class="co">#&gt;   Estonia      28     .    28   211     .    28    28     .   211         .</span></span>
<span><span class="co">#&gt;   Finland     155   119   107   749    48   107   107    71   748         .</span></span>
<span><span class="co">#&gt;   Germany     443     .    14   524     .    14    14    99   569         .</span></span>
<span><span class="co">#&gt;   Latvia        6     .     6     9     .     6     6     .     9         .</span></span>
<span><span class="co">#&gt;   Lithuania    12     .    12    12     .    12    12     .     .         .</span></span>
<span><span class="co">#&gt;   Poland        .     .     .  1152     .     .     .     .  1152         .</span></span>
<span><span class="co">#&gt;   Sweden      505     .   425  3328     .   425   425     .  2283       503</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     CB141 CB149 CB151 CB153 CB156 CB157 CB167 CB169 CB170  CB18 CB180</span></span>
<span><span class="co">#&gt;   Denmark       .   377   246   521   523   108    38    89   446     .   520</span></span>
<span><span class="co">#&gt;   Estonia       .     .     .   211    28    28    28    28     .     .   208</span></span>
<span><span class="co">#&gt;   Finland      71    48     .   749   155   107   107   107   119    71   747</span></span>
<span><span class="co">#&gt;   Germany       .    98     .   568   445    14    14    14    24     .   569</span></span>
<span><span class="co">#&gt;   Latvia        .     .     .     9     6     6     6     6     .     .     9</span></span>
<span><span class="co">#&gt;   Lithuania     .     .     .     .    12    12    12    12     .     .     .</span></span>
<span><span class="co">#&gt;   Poland        .     .     .  1152     .     .     .     .     .     .  1152</span></span>
<span><span class="co">#&gt;   Sweden        .     .     .  2785   505   505   505   505     .     .  2785</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     CB183 CB187 CB189 CB194 CB206 CB209  CB28  CB31  CB33  CB44  CB47</span></span>
<span><span class="co">#&gt;   Denmark       .   174    38     .     .     6   517   504     .   246     .</span></span>
<span><span class="co">#&gt;   Estonia       .     .    28    10     .     .   209     .     .     .     .</span></span>
<span><span class="co">#&gt;   Finland      71   119   107    71    71    71   708    48    71     .    71</span></span>
<span><span class="co">#&gt;   Germany       .     .    14     .     .     .   559     .     .     .     .</span></span>
<span><span class="co">#&gt;   Latvia        .     .     6     .     .     .     8     .     .     .     .</span></span>
<span><span class="co">#&gt;   Lithuania     .     .    12     .     .     .     .     .     .     .     .</span></span>
<span><span class="co">#&gt;   Poland        .     .     .     .     .     .  1152     .     .     .     .</span></span>
<span><span class="co">#&gt;   Sweden        .     .   425     .     .     .  2663     .     .     .     .</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country      CB49  CB51  CB52  CB60  CB66  CB74  CB77  CB81  CB99    CD CDD1N</span></span>
<span><span class="co">#&gt;   Denmark     246     .   519     .     .     .    88    37   247  1913   105</span></span>
<span><span class="co">#&gt;   Estonia       .     .   211     .     .     .    28    28     .    98    26</span></span>
<span><span class="co">#&gt;   Finland      71    48   730    48   119    71   107   107    71   780   109</span></span>
<span><span class="co">#&gt;   Germany       .     .   559     .     .     .    14    14     .   743    14</span></span>
<span><span class="co">#&gt;   Latvia        .     .     9     .     .     .     6     6     .   262     .</span></span>
<span><span class="co">#&gt;   Lithuania     .     .     .     .     .     .    12    12     .    96    12</span></span>
<span><span class="co">#&gt;   Poland        .     .  1152     .     .     .     .     .     .  1419     .</span></span>
<span><span class="co">#&gt;   Sweden        .     .  2674     .     .     .   505   425     .  2835   585</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     CDD4X CDD6P CDD6X CDD9X  CDDO CDDSN CDDSP CDDST CDDSX CDF2N CDF2T</span></span>
<span><span class="co">#&gt;   Denmark     106   105   106   105    80     .     .     .     .   105   105</span></span>
<span><span class="co">#&gt;   Estonia      26    26    26    26    26     .     .     .     .    26    26</span></span>
<span><span class="co">#&gt;   Finland     109   109   109   109   109     .     .     .     .   109   109</span></span>
<span><span class="co">#&gt;   Germany      14    14    14    14    14     .     .     .     .    14    14</span></span>
<span><span class="co">#&gt;   Latvia        .     .     .     .     6     6     6     6     6     .     6</span></span>
<span><span class="co">#&gt;   Lithuania    12    12    12    10     7     .     .     .     .    12    12</span></span>
<span><span class="co">#&gt;   Poland        .     .     .     .     .     .     .     .     .     .     .</span></span>
<span><span class="co">#&gt;   Sweden      585   585   585   585   585     .     .     .     .   665   585</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     CDF4X CDF6P CDF6X CDF9P CDF9X CDFDN  CDFO CDFP2 CDFSN CDFSP CDFST</span></span>
<span><span class="co">#&gt;   Denmark     105   104   106   105   105     .   102   105     .     .     .</span></span>
<span><span class="co">#&gt;   Estonia      26    26    26    26    26     .     .    26     .     .     .</span></span>
<span><span class="co">#&gt;   Finland     109   109   109   109   109     .     .   109     .     .     .</span></span>
<span><span class="co">#&gt;   Germany      14    14    14    14    14     3     .    11     .     .     .</span></span>
<span><span class="co">#&gt;   Latvia        .     .     .     .     .     .     .     .     6     6     6</span></span>
<span><span class="co">#&gt;   Lithuania    12    12    12    12    12     .     .    12     .     .     .</span></span>
<span><span class="co">#&gt;   Poland        .     .     .     .     .     .     .     .     .     .     .</span></span>
<span><span class="co">#&gt;   Sweden      585   585   585   585   585   320   583   425     .     .     .</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     CDFSX CDFX1 DRYWT% EXLIP% FATWT%   FLU  HBCD HBCDA HBCDB HBCDG</span></span>
<span><span class="co">#&gt;   Denmark       .   105   2562    617   1107  1034     .    93    89    89</span></span>
<span><span class="co">#&gt;   Estonia       .    26     63      .     18     .     1    21    21    21</span></span>
<span><span class="co">#&gt;   Finland       .   109   1006    309    558     .     .    70    70    70</span></span>
<span><span class="co">#&gt;   Germany       .    14    805    345    910   156    10     1     1     1</span></span>
<span><span class="co">#&gt;   Latvia        6     .    429      .      6     .     2     2     2     2</span></span>
<span><span class="co">#&gt;   Lithuania     .    12     51      .      .     4    12    12    12    12</span></span>
<span><span class="co">#&gt;   Poland        .     .   1702    380      .    18   620     .     .     .</span></span>
<span><span class="co">#&gt;   Sweden        .   425   5781   3843      5    31  1957     .     .     .</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country        HG  IMPS  INTS LIPIDWT% LNMEA N-PFOS  OCDF    PB   PCB  PFOS</span></span>
<span><span class="co">#&gt;   Denmark    2370   813  4718        .  1878      .     .  1782     .   102</span></span>
<span><span class="co">#&gt;   Estonia     175     .     .      156     .      .    26    98     .    22</span></span>
<span><span class="co">#&gt;   Finland    1412     .     .        .   697      .   109   779    28   164</span></span>
<span><span class="co">#&gt;   Germany     918     .     .        .  2151      .    14   770     .    12</span></span>
<span><span class="co">#&gt;   Latvia      294     .     .        .   267      .     6   170     .     4</span></span>
<span><span class="co">#&gt;   Lithuania   103     .     .       31    17      .    12    96     .    12</span></span>
<span><span class="co">#&gt;   Poland     1429     .     .      909  2538      .     .  1411     .   532</span></span>
<span><span class="co">#&gt;   Sweden     3279     .     .        . 12673    282     2  2834     .   241</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country     PYR1OH   SCB  SCB7 SUM_PCB SUM_PCDD_PCDF SUM_PCDD_PCDF_PCB  TCDD</span></span>
<span><span class="co">#&gt;   Denmark        .     .     .       .             .                 .   105</span></span>
<span><span class="co">#&gt;   Estonia        .    10     .       .             .                 .    26</span></span>
<span><span class="co">#&gt;   Finland        .     .   181       .             .                 .   109</span></span>
<span><span class="co">#&gt;   Germany     1311     .     .       .             .                 .    14</span></span>
<span><span class="co">#&gt;   Latvia         .     .     .       .             .                 .     6</span></span>
<span><span class="co">#&gt;   Lithuania      .     .     .      18            32                32     7</span></span>
<span><span class="co">#&gt;   Poland        54     .     .       .             .                 .     .</span></span>
<span><span class="co">#&gt;   Sweden         .     .     .       .             .                 .   585</span></span>
<span><span class="co">#&gt;            determinand</span></span>
<span><span class="co">#&gt; country       VDS  VDSI</span></span>
<span><span class="co">#&gt;   Denmark    3273    76</span></span>
<span><span class="co">#&gt;   Estonia       .     .</span></span>
<span><span class="co">#&gt;   Finland       .     .</span></span>
<span><span class="co">#&gt;   Germany       .     .</span></span>
<span><span class="co">#&gt;   Latvia        .     .</span></span>
<span><span class="co">#&gt;   Lithuania     .     .</span></span>
<span><span class="co">#&gt;   Poland        .     .</span></span>
<span><span class="co">#&gt;   Sweden     8942   298</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     1979 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991 1992</span></span>
<span><span class="co">#&gt;   Denmark      .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Estonia      .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Finland     13   14   14   44   39   49   59   60   73  163   92  108   81</span></span>
<span><span class="co">#&gt;   Germany      .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Latvia       .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Lithuania    .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Poland       .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Sweden       .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     1993 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006</span></span>
<span><span class="co">#&gt;   Denmark      .    .    .  300 1232  893  980 1646 1475 1624 1331  993 1012</span></span>
<span><span class="co">#&gt;   Estonia      .    .    .    .    .    .    .    .    .    .    4  108  126</span></span>
<span><span class="co">#&gt;   Finland    108   79   81   28  905  909  234  369  450  142  144  571  576</span></span>
<span><span class="co">#&gt;   Germany      .    .    .    .  110  209  211   81   96  110    .  159  156</span></span>
<span><span class="co">#&gt;   Latvia       .    .    .    .    .    .    2   37  120    .    .    .   44</span></span>
<span><span class="co">#&gt;   Lithuania    .    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Poland       .    .    .    .  284  241  315  318  307  280  785  785  785</span></span>
<span><span class="co">#&gt;   Sweden       .    .    . 1663 2049 2235 2148 2413 2180 2720 2446 2439 2193</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019</span></span>
<span><span class="co">#&gt;   Denmark   1034 1540 2442 1306 3732 1789 3208 1546  585  793 1132 1107  965</span></span>
<span><span class="co">#&gt;   Estonia     84   14    .    .  276  368  296  246  247    .   54  235  303</span></span>
<span><span class="co">#&gt;   Finland    557  320  317  371 1019 1382  439 1451  366 1683   47  410 1269</span></span>
<span><span class="co">#&gt;   Germany    839  545 1372 1237 1118 1063 1623 1526 1602  602  915  500  446</span></span>
<span><span class="co">#&gt;   Latvia      67    .    .    .  143   91  149   76   45   85  160  164  125</span></span>
<span><span class="co">#&gt;   Lithuania    8    .   12   21   37   73   58   40  246  353    8   40   24</span></span>
<span><span class="co">#&gt;   Poland     525  525  525  525  525 1226 1428 1700 1588 1600 1590 1596 1639</span></span>
<span><span class="co">#&gt;   Sweden    2404 3544 5325 4670 5447 5395 5192 4562 1492 4559 4892 5227 4920</span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; country     2020 2021</span></span>
<span><span class="co">#&gt;   Denmark   1151  603</span></span>
<span><span class="co">#&gt;   Estonia    400  336</span></span>
<span><span class="co">#&gt;   Finland   1023  743</span></span>
<span><span class="co">#&gt;   Germany    859  415</span></span>
<span><span class="co">#&gt;   Latvia     368    .</span></span>
<span><span class="co">#&gt;   Lithuania   32    .</span></span>
<span><span class="co">#&gt;   Poland    1824 1898</span></span>
<span><span class="co">#&gt;   Sweden    4635  972</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="duplicate-records-1">Duplicate records<a class="anchor" aria-label="anchor" href="#duplicate-records-1"></a>
</h4>
<div class="section level5">
<h5 id="finland---pfos-fatwt">Finland - PFOS, FATWT%<a class="anchor" aria-label="anchor" href="#finland---pfos-fatwt"></a>
</h5>
<p>Some PFOS and FATWT% records from Finland in 2014 and 2015 appear to
be duplicated (see below). Only the first are retained. (There is one
set of FATWT% records which differ, and these are both kept for now - I
wonder whether one of these should actually be MU.)</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Finland"</span>,</span>
<span>    <span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2014</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sub.sample</span>, <span class="va">determinand</span>, <span class="va">matrix</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>, <span class="va">station_name</span>, <span class="va">sub.sample</span>, <span class="va">determinand</span>, <span class="va">matrix</span>, <span class="va">replicate</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">sub.sample</span>, <span class="va">determinand</span>, <span class="va">replicate</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="va">DT_options</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(name): there is no package called 'webshot'</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_rep</span> <span class="op">&lt;-</span> <span class="va">wk</span><span class="op">$</span><span class="va">replicate</span></span>
<span></span>
<span><span class="va">wk_keep</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">sub.sample</span>, <span class="va">matrix</span>, <span class="va">determinand</span>, <span class="va">replicate</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">sub.sample</span>, <span class="va">matrix</span>, <span class="va">determinand</span>, <span class="va">value</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_drop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">wk_rep</span>, <span class="va">wk_keep</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="op">!</span><span class="va">replicate</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_drop</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="sweden---dioxins">Sweden - dioxins<a class="anchor" aria-label="anchor" href="#sweden---dioxins"></a>
</h5>
<p>There are some dioxin measurements from Sweden in 2009 and 2011 which
have been submitted on both a wet and a lipid basis. These are
summarised below for relevant stations (where there are some data in the
last six monitoring years). The ‘duplicates’ should be interchangeable,
and I have retained the measurements on a lipid basis.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_relevant_biota</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">relevant_biota</span> <span class="op">&lt;-</span> <span class="fu">get_relevant_biota</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">relevant_biota</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pargroup</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OC-DX"</span>, <span class="st">"O-BR"</span>, <span class="st">"OC-CB"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sub.sample</span>, <span class="va">matrix</span>, <span class="va">determinand</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="st">"W"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">basis</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">country</span>, <span class="va">station_name</span>, <span class="va">year</span>, <span class="va">determinand</span>, <span class="va">sub.sample</span>, <span class="va">basis</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">factor</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                           indicator      ges_matrix     country    </span></span>
<span><span class="co">#&gt;  dl-PCBs and dioxins and furans:2432   Primary:2432   Sweden:2432  </span></span>
<span><span class="co">#&gt;                                                                    </span></span>
<span><span class="co">#&gt;                                                                    </span></span>
<span><span class="co">#&gt;                                                                    </span></span>
<span><span class="co">#&gt;                                                                    </span></span>
<span><span class="co">#&gt;                                                                    </span></span>
<span><span class="co">#&gt;                                                                    </span></span>
<span><span class="co">#&gt;        mprog       rlabo                    HELCOM_subbasin   HELCOM_L3  </span></span>
<span><span class="co">#&gt;  CEMP~COMB: 128   SERI:2432   Bothnian Sea          :576    6      :448  </span></span>
<span><span class="co">#&gt;  COMB     :2304               Bornholm Basin        :384    2      :384  </span></span>
<span><span class="co">#&gt;                               Bothnian Bay          :384    SEA-007:384  </span></span>
<span><span class="co">#&gt;                               Western Gotland Basin :320    4      :256  </span></span>
<span><span class="co">#&gt;                               Northern Baltic Proper:256    SEA-010:256  </span></span>
<span><span class="co">#&gt;                               The Quark             :256    9      :128  </span></span>
<span><span class="co">#&gt;                               (Other)               :256    (Other):576  </span></span>
<span><span class="co">#&gt;    HELCOM_L4                submitted.station    sd_code    </span></span>
<span><span class="co">#&gt;  SEA-007:384   Ängskärsklubb         : 256    6140   : 256  </span></span>
<span><span class="co">#&gt;  SWE-016:384   Utlängan              : 256    6226   : 256  </span></span>
<span><span class="co">#&gt;  SEA-010:256   Holmöarna             : 192    5809   : 192  </span></span>
<span><span class="co">#&gt;  SWE-022:256   Abbekås               : 128    11188  : 128  </span></span>
<span><span class="co">#&gt;  SWE-021:192   Bothnian Sea off shore: 128    11189  : 128  </span></span>
<span><span class="co">#&gt;  SEA-001:128   Byxelkrok             : 128    5803   : 128  </span></span>
<span><span class="co">#&gt;  (Other):832   (Other)               :1344    (Other):1344  </span></span>
<span><span class="co">#&gt;                    sd_name      station_code                  station_name </span></span>
<span><span class="co">#&gt;  Ängskärsklubb         : 256   6140   : 256   Ängskärsklubb         : 256  </span></span>
<span><span class="co">#&gt;  Utlängan              : 256   6226   : 256   Utlängan              : 256  </span></span>
<span><span class="co">#&gt;  Holmöarna             : 192   5809   : 192   Holmöarna             : 192  </span></span>
<span><span class="co">#&gt;  Abbekås               : 128   11188  : 128   Abbekås               : 128  </span></span>
<span><span class="co">#&gt;  Bothnian Sea off shore: 128   11189  : 128   Bothnian Sea off shore: 128  </span></span>
<span><span class="co">#&gt;  Byxelkrok             : 128   5803   : 128   Byxelkrok             : 128  </span></span>
<span><span class="co">#&gt;  (Other)               :1344   (Other):1344   (Other)               :1344  </span></span>
<span><span class="co">#&gt;       year              date      sample_latitude sample_longitude purpm   </span></span>
<span><span class="co">#&gt;  Min.   :2009   11/05/2009: 128   Min.   :55.32   Min.   :11.83    T:2432  </span></span>
<span><span class="co">#&gt;  1st Qu.:2009   12/10/2010: 128   1st Qu.:57.22   1st Qu.:15.78            </span></span>
<span><span class="co">#&gt;  Median :2009   01/10/2010:  64   Median :60.05   Median :18.16            </span></span>
<span><span class="co">#&gt;  Mean   :2009   04/10/2010:  64   Mean   :60.13   Mean   :18.14            </span></span>
<span><span class="co">#&gt;  3rd Qu.:2010   06/09/2010:  64   3rd Qu.:63.53   3rd Qu.:20.50            </span></span>
<span><span class="co">#&gt;  Max.   :2010   07/08/2009:  64   Max.   :65.76   Max.   :22.88            </span></span>
<span><span class="co">#&gt;                 (Other)   :1920                                            </span></span>
<span><span class="co">#&gt;   finfl                   species       sex        n_individual    pargroup   </span></span>
<span><span class="co">#&gt;  NA's:2432   Clupea harengus  :2240   F   :1280   Min.   : 7.00   OC-DX:2432  </span></span>
<span><span class="co">#&gt;              Perca fluviatilis: 192   M   :1120   1st Qu.:12.00               </span></span>
<span><span class="co">#&gt;                                       NA's:  32   Median :12.00               </span></span>
<span><span class="co">#&gt;                                                   Mean   :11.78               </span></span>
<span><span class="co">#&gt;                                                   3rd Qu.:12.00               </span></span>
<span><span class="co">#&gt;                                                   Max.   :12.00               </span></span>
<span><span class="co">#&gt;                                                                               </span></span>
<span><span class="co">#&gt;   determinand   matrix    basis       unit          value           censoring  </span></span>
<span><span class="co">#&gt;  CDD1N  : 152   MU:2432   L:1216   ng/kg:  76   Min.   :  0.00047   D   : 336  </span></span>
<span><span class="co">#&gt;  CDD4X  : 152             W:1216   pg/g :2356   1st Qu.:  0.07486   NA's:2096  </span></span>
<span><span class="co">#&gt;  CDD6P  : 152                                   Median :  0.69600              </span></span>
<span><span class="co">#&gt;  CDD6X  : 152                                   Mean   :  4.14714              </span></span>
<span><span class="co">#&gt;  CDD9X  : 152                                   3rd Qu.:  3.10000              </span></span>
<span><span class="co">#&gt;  CDDO   : 152                                   Max.   :150.00000              </span></span>
<span><span class="co">#&gt;  (Other):1520                                                                  </span></span>
<span><span class="co">#&gt;   vflag      limit_detection    limit_quantification  uncertainty  </span></span>
<span><span class="co">#&gt;  NA's:2432   Min.   : 0.00047   Min.   : NA          Min.   : NA   </span></span>
<span><span class="co">#&gt;              1st Qu.: 0.07486   1st Qu.: NA          1st Qu.: NA   </span></span>
<span><span class="co">#&gt;              Median : 0.20000   Median : NA          Median : NA   </span></span>
<span><span class="co">#&gt;              Mean   : 0.40771   Mean   :NaN          Mean   :NaN   </span></span>
<span><span class="co">#&gt;              3rd Qu.: 0.60970   3rd Qu.: NA          3rd Qu.: NA   </span></span>
<span><span class="co">#&gt;              Max.   :15.00000   Max.   : NA          Max.   : NA   </span></span>
<span><span class="co">#&gt;                                 NA's   :2432         NA's   :2432  </span></span>
<span><span class="co">#&gt;  unit_uncertainty  alabo      method_analysis  smtyp       dcflgs    </span></span>
<span><span class="co">#&gt;  NA's:2432        UMSC:2432   GC-MS:2432      NA's:2432   NA's:2432  </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;      smpno             subno          qalink         replicate       </span></span>
<span><span class="co">#&gt;  34649  :  64   1022010229:  32   Min.   :516368   Min.   :47976502  </span></span>
<span><span class="co">#&gt;  34650  :  64   1070810719:  32   1st Qu.:516375   1st Qu.:47984157  </span></span>
<span><span class="co">#&gt;  34651  :  64   1072010731:  32   Median :516383   Median :47985670  </span></span>
<span><span class="co">#&gt;  34652  :  64   1098710998:  32   Mean   :516416   Mean   :47988683  </span></span>
<span><span class="co">#&gt;  34653  :  64   1099911010:  32   3rd Qu.:516458   3rd Qu.:47994241  </span></span>
<span><span class="co">#&gt;  34654  :  64   1125311259:  32   Max.   :516466   Max.   :47996074  </span></span>
<span><span class="co">#&gt;  (Other):2048   (Other)   :2240                                      </span></span>
<span><span class="co">#&gt;    sub.sample       sample       tblspotid          upload      subseries  </span></span>
<span><span class="co">#&gt;  3741770:  32   2112871:  64   Min.   :367894   Min.   :10335   NA's:2432  </span></span>
<span><span class="co">#&gt;  3741771:  32   2112872:  64   1st Qu.:367929   1st Qu.:10335              </span></span>
<span><span class="co">#&gt;  3741784:  32   2112873:  64   Median :367950   Median :10335              </span></span>
<span><span class="co">#&gt;  3741785:  32   2112875:  64   Mean   :367952   Mean   :10335              </span></span>
<span><span class="co">#&gt;  3741798:  32   2112876:  64   3rd Qu.:367982   3rd Qu.:10336              </span></span>
<span><span class="co">#&gt;  3741799:  32   2112877:  64   Max.   :368010   Max.   :10336              </span></span>
<span><span class="co">#&gt;  (Other):2240   (Other):2048</span></span>
<span></span>
<span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">basis</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="va">replicate</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="germany---fatwt">Germany - FATWT%<a class="anchor" aria-label="anchor" href="#germany---fatwt"></a>
</h5>
<p>Some FATWT% records from Germany appear to be duplicated (see below).
One set of uncertainty measurements are unusually small, so accept the
other (where either uncertainty is reported as a percentage, or where
the U2 is ten percent of the value).</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Germany"</span>, </span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"FATWT%"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sub.sample</span>, <span class="va">determinand</span>, <span class="va">matrix</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">station_name</span>, <span class="va">sub.sample</span>, <span class="va">determinand</span>, <span class="va">matrix</span>, </span>
<span>         <span class="va">replicate</span>, <span class="va">value</span>, <span class="va">uncertainty</span>, <span class="va">unit_uncertainty</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">year</span>, <span class="va">sub.sample</span>, <span class="va">determinand</span>, <span class="va">replicate</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="va">DT_options</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(name): there is no package called 'webshot'</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_rep</span> <span class="op">&lt;-</span> <span class="va">wk</span><span class="op">$</span><span class="va">replicate</span></span>
<span></span>
<span><span class="va">wk_keep</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">unit_uncertainty</span> <span class="op">==</span> <span class="st">"%"</span> <span class="op">|</span></span>
<span>      <span class="fl">100</span> <span class="op">*</span> <span class="va">uncertainty</span> <span class="op">/</span> <span class="va">value</span> <span class="op">&gt;</span> <span class="fl">5</span>  </span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wk_keep</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wk_rep</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_drop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">wk_rep</span>, <span class="va">wk_keep</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="va">replicate</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_drop</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="pcbs-and-dioxins">PCBs and dioxins<a class="anchor" aria-label="anchor" href="#pcbs-and-dioxins"></a>
</h4>
<p>Here’s a summary of the determinands submitted for PCBs, dioxins and
furans.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span>,</span>
<span>    <span class="va">pargroup</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OC-CB"</span>, <span class="st">"OC-DX"</span>, <span class="st">"OC-DX~OC-CB"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">wk</span><span class="op">$</span><span class="va">determinand</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             CB101             CB105             CB110             CB114 </span></span>
<span><span class="co">#&gt;              5963              1643               411               605 </span></span>
<span><span class="co">#&gt;             CB118             CB122             CB123             CB126 </span></span>
<span><span class="co">#&gt;              6469                48               605               655 </span></span>
<span><span class="co">#&gt;             CB128             CB138         CB138+163             CB141 </span></span>
<span><span class="co">#&gt;               593              5464               503                69 </span></span>
<span><span class="co">#&gt;             CB149             CB151             CB153             CB156 </span></span>
<span><span class="co">#&gt;               523               246              5967              1646 </span></span>
<span><span class="co">#&gt;             CB157             CB167             CB169             CB170 </span></span>
<span><span class="co">#&gt;               755               685               736               587 </span></span>
<span><span class="co">#&gt;              CB18             CB180             CB183             CB187 </span></span>
<span><span class="co">#&gt;                69              5962                69               291 </span></span>
<span><span class="co">#&gt;             CB189             CB194             CB206             CB209 </span></span>
<span><span class="co">#&gt;               605                76                69                75 </span></span>
<span><span class="co">#&gt;              CB28              CB31              CB33              CB44 </span></span>
<span><span class="co">#&gt;              5788               545                69               246 </span></span>
<span><span class="co">#&gt;              CB47              CB49              CB51              CB52 </span></span>
<span><span class="co">#&gt;                69               315                48              5826 </span></span>
<span><span class="co">#&gt;              CB60              CB66              CB74              CB77 </span></span>
<span><span class="co">#&gt;                48               117                69               735 </span></span>
<span><span class="co">#&gt;              CB81              CB99             CDD1N             CDD4X </span></span>
<span><span class="co">#&gt;               604               316               750               751 </span></span>
<span><span class="co">#&gt;             CDD6P             CDD6X             CDD9X              CDDO </span></span>
<span><span class="co">#&gt;               750               751               748               726 </span></span>
<span><span class="co">#&gt;             CDDSN             CDDSP             CDDST             CDDSX </span></span>
<span><span class="co">#&gt;                 6                 6                 6                 6 </span></span>
<span><span class="co">#&gt;             CDF2N             CDF2T             CDF4X             CDF6P </span></span>
<span><span class="co">#&gt;               830               756               750               749 </span></span>
<span><span class="co">#&gt;             CDF6X             CDF9P             CDF9X             CDFDN </span></span>
<span><span class="co">#&gt;               751               750               750               247 </span></span>
<span><span class="co">#&gt;              CDFO             CDFP2             CDFSN             CDFSP </span></span>
<span><span class="co">#&gt;               605               663                 6                 6 </span></span>
<span><span class="co">#&gt;             CDFST             CDFSX             CDFX1              OCDF </span></span>
<span><span class="co">#&gt;                 6                 6               666               148 </span></span>
<span><span class="co">#&gt;               PCB               SCB              SCB7           SUM_PCB </span></span>
<span><span class="co">#&gt;                28                10               181                18 </span></span>
<span><span class="co">#&gt;     SUM_PCDD_PCDF SUM_PCDD_PCDF_PCB              TCDD </span></span>
<span><span class="co">#&gt;                32                32               751</span></span></code></pre></div>
<p>There are some summed values which need to be accounted for. Here
they are by year.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PCB"</span>, <span class="st">"SCB"</span>, <span class="st">"SCB7"</span>, <span class="st">"SUM_PCB"</span>, <span class="st">"SUM_PCDD_PCDF"</span>, <span class="st">"SUM_PCDD_PCDF_PCB"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    year</span></span>
<span><span class="co">#&gt; determinand         1979 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991</span></span>
<span><span class="co">#&gt;   PCB                  2    2    2    4    6    4    4    4    .    .    .    .</span></span>
<span><span class="co">#&gt;   SCB                  .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   SCB7                 .    .    .    .    .    .    .    .    6   15    8    8</span></span>
<span><span class="co">#&gt;   SUM_PCB              .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   SUM_PCDD_PCDF        .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   SUM_PCDD_PCDF_PCB    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;                    year</span></span>
<span><span class="co">#&gt; determinand         1992 1993 1995 1996 1998 1999 2006 2010 2011 2012 2013 2014</span></span>
<span><span class="co">#&gt;   PCB                  .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   SCB                  .    .    .    .    .    .   10    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   SCB7                 6    8    6    6   60   58    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   SUM_PCB              .    .    .    .    .    .    .    .    .    5    4    4</span></span>
<span><span class="co">#&gt;   SUM_PCDD_PCDF        .    .    .    .    .    .    .    5    5    8    5    4</span></span>
<span><span class="co">#&gt;   SUM_PCDD_PCDF_PCB    .    .    .    .    .    .    .    5    5    8    5    4</span></span>
<span><span class="co">#&gt;                    year</span></span>
<span><span class="co">#&gt; determinand         2015</span></span>
<span><span class="co">#&gt;   PCB                  .</span></span>
<span><span class="co">#&gt;   SCB                  .</span></span>
<span><span class="co">#&gt;   SCB7                 .</span></span>
<span><span class="co">#&gt;   SUM_PCB              5</span></span>
<span><span class="co">#&gt;   SUM_PCDD_PCDF        5</span></span>
<span><span class="co">#&gt;   SUM_PCDD_PCDF_PCB    5</span></span></code></pre></div>
<ul>
<li>PCB is ambiguous, deprecated and old</li>
<li>SCB is ambiguous, deprecated and only occurs in 2006</li>
<li>SCB7 is not relevant because it combines non-planar CBs with the
dioxin-like CB118 (and is also pretty old)</li>
<li>SUM_PCB, SUM_PCDD_PCDF and SUM_PCDD_PCDF_PCB are, I think,
Lithuanian food safety data which we made special arrangements for last
time; however, there are no data in the last six monitoring years for
these combinations, nor for individual congeners at the same stations;
these data therefore fall out of the assessment</li>
</ul>
<p>The assessment code doesn’t recognise some of these ad-hoc
determinands without modification, so it is a lot easier to get rid of
them here.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_check</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_id2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SUM_PCB"</span>, <span class="st">"SUM_PCDD_PCDF"</span>, <span class="st">"SUM_PCDD_PCDF_PCB"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">wk_id2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_check</span><span class="op">$</span><span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"have current summed Lithuanian data"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="replicate-measurements">Replicate measurements<a class="anchor" aria-label="anchor" href="#replicate-measurements"></a>
</h4>
<div class="section level5">
<h5 id="sweden---pcbs">Sweden - PCBs<a class="anchor" aria-label="anchor" href="#sweden---pcbs"></a>
</h5>
<p>Some Swedish PCBs (predominantly CB118) have been measured twice in
the same individual, I presume once for the standard set of PCB
reporting and once for dioxin reporting. Here are the number of
measurements affected, with the corresponding analytical laboratory
(restricted to relevant stations where there are data in the last six
monitoring years).</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relevant_biota</span> <span class="op">&lt;-</span> <span class="fu">get_relevant_biota</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">relevant_biota</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">pargroup</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"OC-CB"</span>,</span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Sweden"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sub.sample</span>, <span class="va">matrix</span>, <span class="va">determinand</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">alabo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            alabo</span></span>
<span><span class="co">#&gt; determinand NSLS SLMV UMSC</span></span>
<span><span class="co">#&gt;       CB114    0    0    2</span></span>
<span><span class="co">#&gt;       CB118  247   32  280</span></span>
<span><span class="co">#&gt;       CB123    0    0    2</span></span>
<span><span class="co">#&gt;       CB126    0    0    2</span></span>
<span><span class="co">#&gt;       CB189    0    0    2</span></span>
<span><span class="co">#&gt;       CB81     0    0    2</span></span></code></pre></div>
<p>Here are the analtyical laboratories that also measured dioxins in
these sub-samples.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="va">wk</span><span class="op">$</span><span class="va">sub.sample</span></span>
<span></span>
<span><span class="va">relevant_biota</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">sub.sample</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span>,</span>
<span>    <span class="va">pargroup</span> <span class="op">==</span> <span class="st">"OC-DX"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">alabo</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            alabo</span></span>
<span><span class="co">#&gt; determinand UMSC</span></span>
<span><span class="co">#&gt;       CDD1N  279</span></span>
<span><span class="co">#&gt;       CDD4X  279</span></span>
<span><span class="co">#&gt;       CDD6P  279</span></span>
<span><span class="co">#&gt;       CDD6X  279</span></span>
<span><span class="co">#&gt;       CDD9X  279</span></span>
<span><span class="co">#&gt;       CDDO   279</span></span>
<span><span class="co">#&gt;       CDF2N  279</span></span>
<span><span class="co">#&gt;       CDF2T  279</span></span>
<span><span class="co">#&gt;       CDF4X  279</span></span>
<span><span class="co">#&gt;       CDF6P  279</span></span>
<span><span class="co">#&gt;       CDF6X  279</span></span>
<span><span class="co">#&gt;       CDF9P  279</span></span>
<span><span class="co">#&gt;       CDF9X  279</span></span>
<span><span class="co">#&gt;       CDFDN  101</span></span>
<span><span class="co">#&gt;       CDFO   279</span></span>
<span><span class="co">#&gt;       CDFP2  280</span></span>
<span><span class="co">#&gt;       CDFX1  280</span></span>
<span><span class="co">#&gt;       TCDD   280</span></span></code></pre></div>
<p>Sensible decision seems to be to retain the CB118 measurements from
analytical laboratory UMSC, since they are part of the same analysis
suite. This leaves two replicates for six PCBs in a single sub.sample.
These appear to be genuine replicates. Will leave them both in, and the
code will select one of them for the analysis.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_id</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">alabo</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"UMSC"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pull</span><span class="op">(</span><span class="va">replicate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="op">!</span><span class="va">replicate</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">wk_id</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_relevant_biota</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">pargroup</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"OC-CB"</span>,</span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Sweden"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sub.sample</span>, <span class="va">matrix</span>, <span class="va">determinand</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="va">DT_options</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(name): there is no package called 'webshot'</span></span></code></pre></div>
</div>
</div>
<div class="section level4">
<h4 id="poland-pcb-2014-data">Poland PCB 2014 data<a class="anchor" aria-label="anchor" href="#poland-pcb-2014-data"></a>
</h4>
<p>The following plot shows concentrations of CB153 at each station over
time. All measurements are in fish muscle and units are ug/kg ww. The
species varies between stations, but is consistent within stations.
There are some strange things going on here, but the results from 2014
(red) are particularly strange and are deleted (as are all the other PCB
data for that year for consistency.)</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  .id <span class="op">=</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Poland"</span> <span class="op">&amp;</span> <span class="va">pargroup</span> <span class="op">==</span> <span class="st">"OC-CB"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">determinand</span> <span class="op">==</span> <span class="st">"CB153"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>concentration <span class="op">=</span> <span class="fu"><a href="../reference/convert_units.html">convert_units</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span>, <span class="st">"ug/kg"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span></span>
<span>  <span class="va">wk_data</span><span class="op">$</span><span class="va">matrix</span> <span class="op">==</span> <span class="st">"MU"</span>,</span>
<span>  <span class="va">wk_data</span><span class="op">$</span><span class="va">basis</span> <span class="op">==</span> <span class="st">"W"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">concentration</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">station_name</span>,</span>
<span>  data <span class="op">=</span> <span class="va">wk_data</span>,</span>
<span>  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating <span class="op">=</span> <span class="cn">FALSE</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>log <span class="op">=</span> <span class="cn">TRUE</span>, equispaced.log <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  panel <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">subscripts</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">col</span> <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">wk_data</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="va">subscripts</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2014</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html" class="external-link">lpoints</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/helcom-data-adjust-bio_CB153_1-1.png" alt=""><p class="caption">plot of chunk helcom-data-adjust-bio_CB153_1</p>
</div>
<p>Here is what the data look like without the 2014 values. Many
less-than values are implausibly low relative to the bulk of the data
(see LWLA and LKOL in 2013, and many stations between 2005 and 2008),
and the data could do with further scrutiny. The other PCBs might
exhibit similar features, but this hasn’t been investigated.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">year</span> <span class="op">==</span> <span class="fl">2014</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">determinand</span> <span class="op">==</span> <span class="st">"CB153"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>concentration <span class="op">=</span> <span class="fu"><a href="../reference/convert_units.html">convert_units</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">unit</span>, <span class="st">"ug/kg"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="st">'.id'</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span></span>
<span>  <span class="va">concentration</span> <span class="op">~</span> <span class="va">year</span> <span class="op">|</span> <span class="va">station_name</span>,</span>
<span>  data <span class="op">=</span> <span class="va">wk_data</span>,</span>
<span>  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alternating <span class="op">=</span> <span class="cn">FALSE</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>log <span class="op">=</span> <span class="cn">TRUE</span>, equispaced.log <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  panel <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">subscripts</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">col</span> <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">wk_data</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="va">subscripts</span><span class="op">]</span> <span class="op">==</span> <span class="fl">2014</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html" class="external-link">lpoints</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/helcom-data-adjust-bio_CB153_2-1.png" alt=""><p class="caption">plot of chunk helcom-data-adjust-bio_CB153_2</p>
</div>
</div>
<div class="section level4">
<h4 id="strange-censoring-values">Strange censoring values<a class="anchor" aria-label="anchor" href="#strange-censoring-values"></a>
</h4>
<p>The following data from relevant stations (with data in the last six
years) have censoring = “&gt;”, which is unusual. The German data appear
to be well above the limits of detection, so the “&gt;” has been
removed. The Swedish data appear to be values below the limit of
detection and have been replaced with censoring = “D”.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">get_relevant_biota</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"&gt;"</span>, <span class="va">censoring</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>, <span class="va">determinand</span>, <span class="va">value</span>, <span class="va">censoring</span>, <span class="va">limit_detection</span>, <span class="va">limit_quantification</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">country</span>, <span class="va">year</span>, <span class="va">determinand</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="va">DT_options</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in loadNamespace(name): there is no package called 'webshot'</span></span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  .id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"&gt;"</span>, <span class="va">censoring</span><span class="op">)</span>,</span>
<span>  censoring <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Germany"</span>, <span class="cn">NA_character_</span>, <span class="va">censoring</span><span class="op">)</span>,</span>
<span>  censoring <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Sweden"</span>, <span class="st">"D"</span>, <span class="va">censoring</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="matrix-muep">Matrix MU&amp;EP<a class="anchor" aria-label="anchor" href="#matrix-muep"></a>
</h4>
<p>Here’s a summary of matrices and species for ‘relevant’ stations
(with data in the last six monitoring years).</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relevant_biota</span> <span class="op">&lt;-</span> <span class="fu">get_relevant_biota</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">relevant_biota</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     matrix</span></span>
<span><span class="co">#&gt; species                 BI    LI    MU MU&amp;EP   POP    SB    SH    WO</span></span>
<span><span class="co">#&gt;   Buccinum undatum       .     .     .     .     .  2400     .     9</span></span>
<span><span class="co">#&gt;   Clupea harengus       39  9399 59324     .     .     .     .  4443</span></span>
<span><span class="co">#&gt;   Gadus morhua         275  7060  1066     .     .     .     .   840</span></span>
<span><span class="co">#&gt;   Hinia reticulata       .     .     .     .     .   684     .     .</span></span>
<span><span class="co">#&gt;   Limanda limanda      231  2307   279     .     .     .     .   501</span></span>
<span><span class="co">#&gt;   Limecola balthica      .     .     .     .     .    12     .     .</span></span>
<span><span class="co">#&gt;   Littorina littorea     .     .     .     .     .   379     .     .</span></span>
<span><span class="co">#&gt;   Macoma balthica        .     .     .     .     .    26     .     .</span></span>
<span><span class="co">#&gt;   Mytilus edulis         .     .     .     .     .  7191   925   147</span></span>
<span><span class="co">#&gt;   Neptunea antiqua       .     .     .     .     .   443     .     6</span></span>
<span><span class="co">#&gt;   Perca fluviatilis     16  2421 12190  2423     .     .     .  1253</span></span>
<span><span class="co">#&gt;   Peringia ulvae         .     .     .     .    94  6491  6055     .</span></span>
<span><span class="co">#&gt;   Platichthys flesus   338  4964  5923     .     .     .     .   907</span></span>
<span><span class="co">#&gt;   Zoarces viviparus      .   858  4599     .     .     .     .   269</span></span></code></pre></div>
<p>There are no contaminant data in BI, POP, SH or WO, so we can ignore
these for the current discussion.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relevant_biota</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BI"</span>, <span class="st">"POP"</span>, <span class="st">"SH"</span>, <span class="st">"WO"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;             matrix</span></span>
<span><span class="co">#&gt; determinand    BI  POP   SH   WO</span></span>
<span><span class="co">#&gt;   %FEMALEPOP    .   94    .    .</span></span>
<span><span class="co">#&gt;   LNMEA         .    . 6980 8360</span></span>
<span><span class="co">#&gt;   PYR1OH      899    .    .    .</span></span>
<span><span class="co">#&gt;   VDSI          .    .    .   15</span></span></code></pre></div>
<p>Thus, all contaminant data are in MU and LI (fish) or SB (shellfish)
apart from some measurements in MU&amp;EP. These are all in Perch from
Finland where there also MU measurements. These need to be teased apart.
Here’s a summary of the number of records in perch from Finland by
matrix and year.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">relevant_biota</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Finland"</span>,</span>
<span>    <span class="va">species</span> <span class="op">==</span> <span class="st">"Perca fluviatilis"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">matrix</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;        year</span></span>
<span><span class="co">#&gt; matrix  2011 2012 2014 2015 2016 2019 2020 2021</span></span>
<span><span class="co">#&gt;   LI       .    .    2    3    4    8   12   10</span></span>
<span><span class="co">#&gt;   MU      51  321    9   26   40   89   63   10</span></span>
<span><span class="co">#&gt;   MU&amp;EP    .    .   12  209  595  632  540  435</span></span></code></pre></div>
<p>Muscle and skin measurements all start in 2014. Here are the matrices
for CD, HG, PB, PFOS and everything else by year.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op">!=</span> <span class="st">"FATWT%"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    determinand <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD"</span>, <span class="st">"PB"</span>, <span class="st">"HG"</span>, <span class="st">"PFOS"</span><span class="op">)</span>,</span>
<span>      <span class="va">determinand</span>,</span>
<span>      <span class="st">"other"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">matrix</span>, <span class="va">year</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , determinand = CD</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        year</span></span>
<span><span class="co">#&gt; matrix  2011 2012 2014 2015 2016 2019 2020 2021</span></span>
<span><span class="co">#&gt;   LI       .    .    .    .    2    4    6    5</span></span>
<span><span class="co">#&gt;   MU       .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   MU&amp;EP    .    .    .    .    .    1    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , determinand = HG</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        year</span></span>
<span><span class="co">#&gt; matrix  2011 2012 2014 2015 2016 2019 2020 2021</span></span>
<span><span class="co">#&gt;   LI       .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   MU      15   55    5   20   40   89   63   10</span></span>
<span><span class="co">#&gt;   MU&amp;EP    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , determinand = other</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        year</span></span>
<span><span class="co">#&gt; matrix  2011 2012 2014 2015 2016 2019 2020 2021</span></span>
<span><span class="co">#&gt;   LI       .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   MU      34  248    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   MU&amp;EP    .    .    6  192  575  610  528  425</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , determinand = PB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        year</span></span>
<span><span class="co">#&gt; matrix  2011 2012 2014 2015 2016 2019 2020 2021</span></span>
<span><span class="co">#&gt;   LI       .    .    .    .    2    4    6    5</span></span>
<span><span class="co">#&gt;   MU       .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   MU&amp;EP    .    .    .    .    .    1    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , determinand = PFOS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        year</span></span>
<span><span class="co">#&gt; matrix  2011 2012 2014 2015 2016 2019 2020 2021</span></span>
<span><span class="co">#&gt;   LI       .    .    2    3    .    .    .    .</span></span>
<span><span class="co">#&gt;   MU       .    2    2    3    .    .    .    .</span></span>
<span><span class="co">#&gt;   MU&amp;EP    .    .    2    3   10   10   12   10</span></span></code></pre></div>
<p>Routes forward:</p>
<ul>
<li>Cadmium and lead: look at liver and drop the single MU&amp;EP
measurement (the extraction table only mentions LI and MU for these
metals)</li>
<li>Mercury: all in muscle, so all good</li>
<li>PFOS: there is no lipid adjustment and it doesn’t make sense to
combine MU and MU&amp;EP measurements in the same time series as there
appears to be a systematic difference in concentration between matrices
(see below); select MU&amp;EP as these are the most recent data (Emmi,
16 August); note that the liver and muscle data drop out automatically
as there are no data in the last six monitoring years</li>
<li>Others (organics): combine MU&amp;EP and MU measurements in the same
time series following lipid normalisation; the time series will be
labelled as matrix MU&amp;EP in the summary file since these are the
most recent measurements</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op">==</span> <span class="st">"PFOS"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">matrix</span> <span class="op">!=</span> <span class="st">"LI"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">matrix</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"MU"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">station_name</span>, <span class="va">year</span>, <span class="va">matrix</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">station_name</span>, <span class="va">year</span>, <span class="va">matrix</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;            station_name year matrix value</span></span>
<span><span class="co">#&gt; 1              Ahlainen 2015     MU  1.45</span></span>
<span><span class="co">#&gt; 2              Ahlainen 2015  MU&amp;EP  2.37</span></span>
<span><span class="co">#&gt; 3           Kellonlahti 2014     MU  1.37</span></span>
<span><span class="co">#&gt; 4           Kellonlahti 2014  MU&amp;EP  2.42</span></span>
<span><span class="co">#&gt; 5              Parainen 2015     MU  1.00</span></span>
<span><span class="co">#&gt; 6              Parainen 2015  MU&amp;EP  1.61</span></span>
<span><span class="co">#&gt; 7      Seurasaarenselkä 2012     MU  1.79</span></span>
<span><span class="co">#&gt; 8      Seurasaarenselkä 2012     MU  1.79</span></span>
<span><span class="co">#&gt; 9  Vanhankaupunginlahti 2015     MU 10.60</span></span>
<span><span class="co">#&gt; 10 Vanhankaupunginlahti 2015  MU&amp;EP 18.00</span></span>
<span><span class="co">#&gt; 11           Vaskiluoto 2014     MU  4.98</span></span>
<span><span class="co">#&gt; 12           Vaskiluoto 2014  MU&amp;EP  7.92</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    .id <span class="op">=</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Finland"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">species</span> <span class="op">==</span> <span class="st">"Perca fluviatilis"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span></span>
<span>      <span class="va">matrix</span> <span class="op">==</span> <span class="st">"MU&amp;EP"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD"</span>, <span class="st">"PB"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span></span>
<span>      <span class="va">matrix</span> <span class="op">==</span> <span class="st">"MU"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PFOS"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>.id <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="germany-station-issues">Germany station issues<a class="anchor" aria-label="anchor" href="#germany-station-issues"></a>
</h4>
<p>Some data are submitted for station OMMVKHO (number of samples by
year below), but this station is not in the station dictionary. However,
there is a station called KHO with compatible co-ordinates, so the
station has been relabelled as KHO.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  .id <span class="op">=</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Germany"</span> <span class="op">&amp;</span> <span class="va">submitted.station</span> <span class="op">==</span> <span class="st">"OMMVKHO"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">sample</span>, <span class="va">year</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">submitted.station</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  year</span></span>
<span><span class="co">#&gt; submitted.station 2017 2020</span></span>
<span><span class="co">#&gt;           OMMVKHO    1    2</span></span>
<span></span>
<span><span class="va">wk_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_station_code.html">get_station_code</a></span><span class="op">(</span><span class="st">"KHO"</span>, <span class="st">"Germany"</span>, <span class="va">biota_data</span><span class="op">$</span><span class="va">stations</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  station_name <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.id</span>, <span class="st">"KHO"</span>, <span class="va">station_name</span><span class="op">)</span>,</span>
<span>  station_code <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">.id</span>, <span class="va">wk_code</span>, <span class="va">station_code</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="pyr1oh">PYR1OH<a class="anchor" aria-label="anchor" href="#pyr1oh"></a>
</h4>
<p>A quick summary of the data.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relevant_biota</span> <span class="op">&lt;-</span> <span class="fu">get_relevant_biota</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">relevant_biota</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"PYR1OH"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">year</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , country = Germany</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                     year</span></span>
<span><span class="co">#&gt; species              2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019</span></span>
<span><span class="co">#&gt;   Clupea harengus       .   21    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Gadus morhua          .    .    .    .   34    .   78    .   51   54   42</span></span>
<span><span class="co">#&gt;   Limanda limanda      60   11   12   10   15   17   21    .   19   19   14</span></span>
<span><span class="co">#&gt;   Perca fluviatilis     .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Platichthys flesus   99   23   28   34    .   58   59    .   20    .    .</span></span>
<span><span class="co">#&gt;                     year</span></span>
<span><span class="co">#&gt; species              2020 2021</span></span>
<span><span class="co">#&gt;   Clupea harengus       .    .</span></span>
<span><span class="co">#&gt;   Gadus morhua         16    .</span></span>
<span><span class="co">#&gt;   Limanda limanda      33    .</span></span>
<span><span class="co">#&gt;   Perca fluviatilis     .    .</span></span>
<span><span class="co">#&gt;   Platichthys flesus    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Poland</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                     year</span></span>
<span><span class="co">#&gt; species              2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019</span></span>
<span><span class="co">#&gt;   Clupea harengus       .    .    .    2    .    2    2    2    2    2    2</span></span>
<span><span class="co">#&gt;   Gadus morhua          .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Limanda limanda       .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Perca fluviatilis     .    .    .    .    .    2    2    2    2    2    2</span></span>
<span><span class="co">#&gt;   Platichthys flesus    .    .    .    1    .    1    1    2    2    2    2</span></span>
<span><span class="co">#&gt;                     year</span></span>
<span><span class="co">#&gt; species              2020 2021</span></span>
<span><span class="co">#&gt;   Clupea harengus       2    2</span></span>
<span><span class="co">#&gt;   Gadus morhua          .    .</span></span>
<span><span class="co">#&gt;   Limanda limanda       .    .</span></span>
<span><span class="co">#&gt;   Perca fluviatilis     2    2</span></span>
<span><span class="co">#&gt;   Platichthys flesus    3    3</span></span></code></pre></div>
<p>PAH metabolite units can be the concentration of the metabolite
itself (ng/g or similar), or the concentration relative to that of bile
pigments (e.g. ng g-1 a380-1). For the assessment only consider the
metabolite concentrations. Delete concentration data relative to bile
pigments.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relevant_biota</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"PYR1OH"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">unit</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     unit</span></span>
<span><span class="co">#&gt; species              ng g-1 a380-1 ng g-1 a660-1 ng/g ng/ml ug/ml</span></span>
<span><span class="co">#&gt;   Clupea harengus                .             .   25     2    12</span></span>
<span><span class="co">#&gt;   Gadus morhua                   .             .  275     .     .</span></span>
<span><span class="co">#&gt;   Limanda limanda               20            20  191     .     .</span></span>
<span><span class="co">#&gt;   Perca fluviatilis              .             .    4     .    12</span></span>
<span><span class="co">#&gt;   Platichthys flesus            33            33  261     1    10</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="op">!</span><span class="va">unit</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ng g-1 a380-1 ng"</span>, <span class="st">"ng g-1 a660-1"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here is a summary of the data by method of analysis (which is
important for application of the EAC). Drop GRS data, as these were part
of a one-off project (Ulrike, 2 September).</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">get_relevant_biota</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"PYR1OH"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">method_analysis</span>, <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 year</span></span>
<span><span class="co">#&gt; method_analysis  2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020</span></span>
<span><span class="co">#&gt;   GC-MS-MS          .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   GRS             106    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   HPLC-ESI-MS-MS    .    .    .    .    .    .    .    .    .    .    .    7</span></span>
<span><span class="co">#&gt;   HPLC-FD           .   55   40   47   49   80  163    6   96   79   62   49</span></span>
<span><span class="co">#&gt;                 year</span></span>
<span><span class="co">#&gt; method_analysis  2021</span></span>
<span><span class="co">#&gt;   GC-MS-MS          7</span></span>
<span><span class="co">#&gt;   GRS               .</span></span>
<span><span class="co">#&gt;   HPLC-ESI-MS-MS    .</span></span>
<span><span class="co">#&gt;   HPLC-FD           .</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"PYR1OH"</span> <span class="op">&amp;</span> <span class="va">method_analysis</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"GRS"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And here is what is left by species and country. Conventionally,
separate time series are modelled for each method of analysis. However,
for this assessment, the remaining methods of analysis will be regarded
as comparable (Ulrike, 15 August). They will be labelled as being
HPLC-FD in the summary file, since these correspond to the bulk of the
measurements for both Germany and Poland. (This is coded in the main
assessment file.)</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">get_relevant_biota</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"PYR1OH"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">method_analysis</span>, <span class="va">year</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , country = Germany</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 year</span></span>
<span><span class="co">#&gt; method_analysis  2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;   GC-MS-MS          .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   HPLC-ESI-MS-MS    .    .    .    .    .    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   HPLC-FD          55   40   44   49   75  158    .   90   73   56   49    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Poland</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 year</span></span>
<span><span class="co">#&gt; method_analysis  2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;   GC-MS-MS          .    .    .    .    .    .    .    .    .    .    .    7</span></span>
<span><span class="co">#&gt;   HPLC-ESI-MS-MS    .    .    .    .    .    .    .    .    .    .    7    .</span></span>
<span><span class="co">#&gt;   HPLC-FD           .    .    3    .    5    5    6    6    6    6    .    .</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sbde6-1">SBDE6<a class="anchor" aria-label="anchor" href="#sbde6-1"></a>
</h4>
<p>For info, here are the PBDE measurements by country (again filtered
on stations that have been monitored in the last six years). For
simplicity, I’ve restricted it to the last twelve years. Some historic
data from Denmark and Sweden will be lost when computing the sum of the
six PBDEs. Note that HOLAS2 assessed SBDE4 = BDE47 + BDE99 + BD100 +
BD153, because many BDE28 and BD154 measurements, predominantly from
Denmark and Sweden, were missing; this is far less of an issue now.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"BD"</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">year</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , country = Denmark</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    6    8    7    8    3    7   21   14   14   13    8</span></span>
<span><span class="co">#&gt;       BD153    .    6    8    7    8    3    7   20   14   14   13    8</span></span>
<span><span class="co">#&gt;       BD154    .    6    8    7    8    3    7   21   14   14   13    8</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    .    8    3    6   20   14   14   13    8</span></span>
<span><span class="co">#&gt;       BDE47    .    6    4    4    3    2    7   20   14   14   13    8</span></span>
<span><span class="co">#&gt;       BDE99    .    6    6    7    8    2    7   21   14   14   13    8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Estonia</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    .    .    .    .    .    .    1    5    6    8    7</span></span>
<span><span class="co">#&gt;       BD153    .    .    .    .    .    .    .    1    5    6    8    7</span></span>
<span><span class="co">#&gt;       BD154    .    .    .    .    .    .    .    1    5    6    8    7</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    .    .    .    .    1    5    6    8    7</span></span>
<span><span class="co">#&gt;       BDE47    .    .    .    .    .    .    .    1    5    6    8    7</span></span>
<span><span class="co">#&gt;       BDE99    .    .    .    .    .    .    .    1    5    6    8    7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Finland</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    4    8    .   17    3   19    .    5   18   20   16</span></span>
<span><span class="co">#&gt;       BD153    .    4    8    .   17    3   19    .    5   18   20   16</span></span>
<span><span class="co">#&gt;       BD154    .    4    8    .   17    3   19    .    5   18   20   16</span></span>
<span><span class="co">#&gt;       BDE28    .    4    8    .   17    3   19    .    5   18   20   16</span></span>
<span><span class="co">#&gt;       BDE47    .    4    8    .   17    3   19    .    5   18   20   16</span></span>
<span><span class="co">#&gt;       BDE99    .    4    8    .   17    3   19    .    5   18   20   16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Germany</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    .    .    .    .    .    .    1    2    2    4    2</span></span>
<span><span class="co">#&gt;       BD153    .    .    .    .    .    .    .    1    2    2    4    2</span></span>
<span><span class="co">#&gt;       BD154    .    .    .    .    .    .    .    1    2    2    4    2</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    .    .    .    .    1    2    2    4    2</span></span>
<span><span class="co">#&gt;       BDE47    .    .    .    .    .    .    .    1    2    2    4    2</span></span>
<span><span class="co">#&gt;       BDE99    .    .    .    .    .    .    .    1    2    2    4    2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Latvia</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    .    .    .    .    .    .    2    .    .    4    .</span></span>
<span><span class="co">#&gt;       BD153    .    .    .    .    .    .    .    2    .    .    4    .</span></span>
<span><span class="co">#&gt;       BD154    .    .    .    .    .    .    .    2    .    .    4    .</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    .    .    .    .    2    .    .    4    .</span></span>
<span><span class="co">#&gt;       BDE47    .    .    .    .    .    .    .    2    .    .    4    .</span></span>
<span><span class="co">#&gt;       BDE99    .    .    .    .    .    .    .    2    .    .    4    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Lithuania</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    .    .    .    .    3    7    .    .    .    .    .</span></span>
<span><span class="co">#&gt;       BD153    .    .    .    .    .    3    7    .    .    .    .    .</span></span>
<span><span class="co">#&gt;       BD154    .    .    .    .    .    3    7    .    .    .    .    .</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    .    .    3    7    .    .    .    .    .</span></span>
<span><span class="co">#&gt;       BDE47    .    .    .    .    .    3    7    .    .    .    .    .</span></span>
<span><span class="co">#&gt;       BDE99    .    .    .    .    .    3    7    .    .    .    .    .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Poland</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100    .    .   34   34   54   54   64   64   64   64   74   74</span></span>
<span><span class="co">#&gt;       BD153    .    .   34   34   54   54   64   64   64   64   74   74</span></span>
<span><span class="co">#&gt;       BD154    .    .   34   34   54   54   64   64   64   64   74   74</span></span>
<span><span class="co">#&gt;       BDE28    .    .   34   34   54   54   64   64   64   64   74   74</span></span>
<span><span class="co">#&gt;       BDE47    .    .   34   34   54   54   64   64   64   64   74   74</span></span>
<span><span class="co">#&gt;       BDE99    .    .   34   34   54   54   64   64   64   64   74   74</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , country = Sweden</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;            year</span></span>
<span><span class="co">#&gt; determinand 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;       BD100  102  106  106  106   94    .   92  104  100   86   88    .</span></span>
<span><span class="co">#&gt;       BD153  102  106  106  106   94    .   92  104  100   86   88    .</span></span>
<span><span class="co">#&gt;       BD154    .    .    .    .    .    .   92  104   98   85   88    .</span></span>
<span><span class="co">#&gt;       BDE28    .    .    .    .    .    .   92  104  100   86   88    .</span></span>
<span><span class="co">#&gt;       BDE47  102  106  106  106   94    .   92  104  100   86   88    .</span></span>
<span><span class="co">#&gt;       BDE99  102  106  106  106   94    .   92  104   99   86   88    .</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="teq-dfp">TEQ DFP<a class="anchor" aria-label="anchor" href="#teq-dfp"></a>
</h4>
<p>Here are the PCB and dioxin measurements that contribute to the TEQ
DFP by country (since 2010). Estonia, Finland, Germany and Lithuania are
largely missing CDFO, and Germany is missing three measurements of
CDFP2.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">info_TEQ</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sub.sample</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">pargroup</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"OC-DX"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            country</span></span>
<span><span class="co">#&gt; determinand Denmark Estonia Finland Germany Latvia Lithuania Sweden</span></span>
<span><span class="co">#&gt;       CB105      74      26      63      14      6        10    452</span></span>
<span><span class="co">#&gt;       CB118      73      26      63      17      6        10    452</span></span>
<span><span class="co">#&gt;       CB126      70      26      63      14      6        10    415</span></span>
<span><span class="co">#&gt;       CB156      74      26      63      14      6        10    452</span></span>
<span><span class="co">#&gt;       CB157      34      26      63      14      6        10    452</span></span>
<span><span class="co">#&gt;       CB167      34      26      63      14      6        10    452</span></span>
<span><span class="co">#&gt;       CB169      71      26      63      14      6        10    452</span></span>
<span><span class="co">#&gt;       CB77       70      26      63      14      6        10    452</span></span>
<span><span class="co">#&gt;       CB81       34      26      63      14      6        10    415</span></span>
<span><span class="co">#&gt;       CDD1N      91      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDD4X      92      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDD6P      91      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDD6X      92      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDD9X      91      26     100      14      .         8    452</span></span>
<span><span class="co">#&gt;       CDDO       74      26     100      14      6         7    452</span></span>
<span><span class="co">#&gt;       CDF2N      91      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDF2T      91      26     100      14      6        10    452</span></span>
<span><span class="co">#&gt;       CDF4X      91      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDF6P      90      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDF6X      92      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDF9P      91      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDF9X      91      26     100      14      .        10    452</span></span>
<span><span class="co">#&gt;       CDFO       90       .       .       .      .         .    452</span></span>
<span><span class="co">#&gt;       CDFP2      91      26     100      11      .        10    415</span></span>
<span><span class="co">#&gt;       CDFX1      91      26     100      14      .        10    415</span></span>
<span><span class="co">#&gt;       TCDD       91      26     100      14      6         7    452</span></span></code></pre></div>
<p>However, it turns out that these countries have submitted similar
(identical?) compounds under related codes. OCDF will be recoded as CDFO
and CDFDN will be recoded as CDFP2.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">pargroup</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"OC-DX"</span>,</span>
<span>    <span class="op">!</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">info_TEQ</span><span class="op">)</span>,</span>
<span>    <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Estonia"</span>, <span class="st">"Finland"</span>, <span class="st">"Germany"</span>, <span class="st">"Lithuania"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2010</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">determinand</span>, <span class="va">country</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;            country</span></span>
<span><span class="co">#&gt; determinand Estonia Finland Germany Lithuania</span></span>
<span><span class="co">#&gt;       CDFDN       .       .       3         .</span></span>
<span><span class="co">#&gt;       OCDF       26     100      14        10</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  determinand <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Estonia"</span>, <span class="st">"Finland"</span>, <span class="st">"Germany"</span>, <span class="st">"Lithuania"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"OCDF"</span>,</span>
<span>    <span class="st">"CDFO"</span>,</span>
<span>    <span class="va">determinand</span></span>
<span>  <span class="op">)</span>,</span>
<span>  determinand <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Germany"</span> <span class="op">&amp;</span> <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"CDFDN"</span>,</span>
<span>    <span class="st">"CDFP2"</span>,</span>
<span>    <span class="va">determinand</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="imposex">Imposex<a class="anchor" aria-label="anchor" href="#imposex"></a>
</h4>
<div class="section level5">
<h5 id="data-summary-3">Data summary<a class="anchor" aria-label="anchor" href="#data-summary-3"></a>
</h5>
<p>Here is a summary of the imposex measurements by species.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">station_name</span><span class="op">)</span>,</span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDS"</span>, <span class="st">"VDSI"</span>, <span class="st">"INTS"</span>, <span class="st">"INTSI"</span>, <span class="st">"IMPS"</span>, <span class="st">"IMPSI"</span>, <span class="st">"PCI"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        determinand</span></span>
<span><span class="co">#&gt; species                 IMPS INTS  VDS VDSI</span></span>
<span><span class="co">#&gt;   Buccinum undatum       680  670 1525   40</span></span>
<span><span class="co">#&gt;   Hinia reticulata         . 1244 1394    .</span></span>
<span><span class="co">#&gt;   Littorina littorea       . 2580    .    .</span></span>
<span><span class="co">#&gt;   Nassarius reticulatus    .    . 2856   84</span></span>
<span><span class="co">#&gt;   Neptunea antiqua       133  121  280   31</span></span>
<span><span class="co">#&gt;   Nucella lapillus         .    .   21    5</span></span>
<span><span class="co">#&gt;   Peringia ulvae           .    . 6022  212</span></span></code></pre></div>
<p>Nassarius reticulatus is equivalent to Hinia reticulata so combine
(called Tritia nitida / reticulata in the assessment output). Having
done so, here are the number of measurements for relevant stations (with
data in the last six years).</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">species</span>, <span class="st">"Nassarius reticulatus"</span> <span class="op">=</span> <span class="st">"Hinia reticulata"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">station_name</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="fl">2016</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     determinand</span></span>
<span><span class="co">#&gt; species              IMPS INTS  VDS VDSI</span></span>
<span><span class="co">#&gt;   Buccinum undatum    259  424  859   28</span></span>
<span><span class="co">#&gt;   Hinia reticulata      .  112  206    .</span></span>
<span><span class="co">#&gt;   Littorina littorea    .  379    .    .</span></span>
<span><span class="co">#&gt;   Neptunea antiqua      1    3   30    1</span></span>
<span><span class="co">#&gt;   Peringia ulvae        .    . 5955  210</span></span></code></pre></div>
<p>Will only assess VDS and VDSI for Buccinum, Hinia, Neptunea and
Peringia and INTS for Littorina. Here is a simple summary of the
individual measurements.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDS"</span>, <span class="st">"VDSI"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Littorina littorea"</span><span class="op">)</span> <span class="op">|</span></span>
<span>      <span class="va">species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Littorina littorea"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     determinand</span></span>
<span><span class="co">#&gt; species              INTS  VDS VDSI</span></span>
<span><span class="co">#&gt;   Buccinum undatum      .  859   28</span></span>
<span><span class="co">#&gt;   Hinia reticulata      .  206    .</span></span>
<span><span class="co">#&gt;   Littorina littorea  379    .    .</span></span>
<span><span class="co">#&gt;   Neptunea antiqua      .   30    1</span></span>
<span><span class="co">#&gt;   Peringia ulvae        . 5955  210</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDS"</span>, <span class="st">"INTS"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">value</span>, <span class="va">determinand</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , determinand = INTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                     value</span></span>
<span><span class="co">#&gt; species                 0    1    2    3 4 5 6</span></span>
<span><span class="co">#&gt;   Buccinum undatum      .    .    .    . . . .</span></span>
<span><span class="co">#&gt;   Hinia reticulata      .    .    .    . . . .</span></span>
<span><span class="co">#&gt;   Littorina littorea  227   75    8   69 . . .</span></span>
<span><span class="co">#&gt;   Neptunea antiqua      .    .    .    . . . .</span></span>
<span><span class="co">#&gt;   Peringia ulvae        .    .    .    . . . .</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , determinand = VDS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                     value</span></span>
<span><span class="co">#&gt; species                 0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Buccinum undatum    815   35    2    3    4    .    .</span></span>
<span><span class="co">#&gt;   Hinia reticulata     37   55   13   47   54    .    .</span></span>
<span><span class="co">#&gt;   Littorina littorea    .    .    .    .    .    .    .</span></span>
<span><span class="co">#&gt;   Neptunea antiqua     28    1    .    .    1    .    .</span></span>
<span><span class="co">#&gt;   Peringia ulvae     4243 1337  191   23   57   82   22</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="sweden---missing-zeros">Sweden - missing zeros<a class="anchor" aria-label="anchor" href="#sweden---missing-zeros"></a>
</h5>
<p>Sweden have a legacy problem in that, for some years, individual
measurements were not submitted when VDS = 0. This biases the assessment
and creates problems in the statistical models used. The Swedish
individual measurements (for relevant stations) are shown below by year
and species. There are no zero values in 2010 which is incompatible with
all other years. (The same can be found for 2007 2008 and 2010 Swedish
Nassarius data, although Nassarius have not been monitored since 2015,
so do not show here.) Consequently, will delete the 2010 data.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"VDS"</span>,</span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Sweden"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">year</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>zero.print <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , species = Peringia ulvae</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      year</span></span>
<span><span class="co">#&gt; value 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021</span></span>
<span><span class="co">#&gt;     0  257  282    .  310  331  348  350  316  333  317  324  356  359  360</span></span>
<span><span class="co">#&gt;     1   59   67   85  128  127  115   87  103   74   97  110   96   87  102</span></span>
<span><span class="co">#&gt;     2    9   16   20   19   24   18   21    8   11   11   13    4   12    5</span></span>
<span><span class="co">#&gt;     3    1    .    1    3    1    2    2    3    .    2    6    .    .    2</span></span>
<span><span class="co">#&gt;     4    7   19    3   15    3    1    1    .    5    2    .    .    .    1</span></span>
<span><span class="co">#&gt;     5   29    6    7    9   10    7    7    6    .    1    .    .    .    .</span></span>
<span><span class="co">#&gt;     6    1    2    7    1    3    2    2    .    .    .    .    3    1    .</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Sweden"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDS"</span>, <span class="st">"VDSI"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="va">year</span> <span class="op">==</span> <span class="fl">2010</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The four measurements with VDS = 6 in 2019 and 2020 are very strange.
They are well separated from the bulk of the data, which are all <span class="math inline">\(\le\)</span> 2 in those years. Further, VDSI
submissions for the same stations and years suggest that the four
measurements with VDS = 6 have not been included in the index
calculations. These four large measurements are excluded.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Sweden"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"VDS"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">2020</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>      <span class="va">value</span> <span class="op">==</span> <span class="fl">6</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="denmark---replicates">Denmark - replicates<a class="anchor" aria-label="anchor" href="#denmark---replicates"></a>
</h5>
<p>Denmark has reported two results for VDSI in the same sub-sample at
DMU D2 in 2015 (see below). Have deleted the larger value, which is
suspiciously high for Buccinum. It looks more like a sample of Neptunea
anitqua (see results from 2009) although there is no record of Neptunea
being sampled at this station in any year other than 2009.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"VDSI"</span>,</span>
<span>    <span class="va">station_name</span> <span class="op">==</span> <span class="st">"DMU D2"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">date</span>, <span class="va">station_name</span>, <span class="va">species</span>, <span class="va">sub.sample</span>, <span class="va">replicate</span>, <span class="va">n_individual</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year       date station_name          species sub.sample replicate</span></span>
<span><span class="co">#&gt; 1 2009 11/09/2009       DMU D2 Neptunea antiqua    3948136  60544584</span></span>
<span><span class="co">#&gt; 2 2009 11/09/2009       DMU D2 Buccinum undatum    3948135  60544583</span></span>
<span><span class="co">#&gt; 3 2011 11/08/2011       DMU D2 Buccinum undatum    3936822  60503664</span></span>
<span><span class="co">#&gt; 4 2015 23/08/2015       DMU D2 Buccinum undatum    3725887  45634490</span></span>
<span><span class="co">#&gt; 5 2015 23/08/2015       DMU D2 Buccinum undatum    3725887  45634489</span></span>
<span><span class="co">#&gt;   n_individual value</span></span>
<span><span class="co">#&gt; 1           27  3.42</span></span>
<span><span class="co">#&gt; 2           51  0.14</span></span>
<span><span class="co">#&gt; 3           48  0.02</span></span>
<span><span class="co">#&gt; 4           20  2.50</span></span>
<span><span class="co">#&gt; 5           20  0.00</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="op">!</span><span class="op">(</span><span class="va">station_name</span> <span class="op">==</span> <span class="st">"DMU D2"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">year</span> <span class="op">==</span> <span class="fl">2015</span> <span class="op">&amp;</span></span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"VDSI"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">value</span> <span class="op">&gt;</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="prepare-data-for-next-stage">Prepare data for next stage<a class="anchor" aria-label="anchor" href="#prepare-data-for-next-stage"></a>
</h3>
<p>This gets the correct variable and streamlines some of the data
files.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_tidy_data.html">ctsm_tidy_data</a></span><span class="op">(</span><span class="va">biota_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/biota' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/biota_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning station dictionary</span></span>
<span><span class="co">#&gt;    Duplicate stations - first one selected: see duplicate_stations.csv</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning contaminant and biological effects data</span></span>
<span><span class="co">#&gt;    Submitted.station unrecognised by dictionary: see stations_unrecognised.csv</span></span>
<span><span class="co">#&gt;    Dropping data with no stations</span></span>
<span><span class="co">#&gt;    Conflicting QA information - first one selected: see conflicting_QA.csv</span></span>
<span><span class="va">sediment_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_tidy_data.html">ctsm_tidy_data</a></span><span class="op">(</span><span class="va">sediment_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/sediment' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/sediment_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning station dictionary</span></span>
<span><span class="co">#&gt;    Duplicate stations - first one selected: see duplicate_stations.csv</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning contaminant and biological effects data</span></span>
<span><span class="co">#&gt;    Submitted.station unrecognised by dictionary: see stations_unrecognised.csv</span></span>
<span><span class="co">#&gt;    Dropping data with no stations</span></span>
<span><span class="va">water_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_tidy_data.html">ctsm_tidy_data</a></span><span class="op">(</span><span class="va">water_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/water' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/water_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning station dictionary</span></span>
<span><span class="co">#&gt;    Duplicate stations - first one selected: see duplicate_stations.csv</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning contaminant and biological effects data</span></span>
<span><span class="co">#&gt;    Dropping data with no stations</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="construct-timeseries">Construct timeseries<a class="anchor" aria-label="anchor" href="#construct-timeseries"></a>
</h3>
</div>
<div class="section level3">
<h3 id="biota-1">Biota<a class="anchor" aria-label="anchor" href="#biota-1"></a>
</h3>
<p>Ad-hoc change to merge MU and MU&amp;EP data for organics for Finnish
perch only need to do this for years up to and including 2013 when there
are no MU&amp;EP measurements, so no risk of mixing up MU and MU&amp;EP
data.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">stations</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"station_code"</span>, <span class="st">"country"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"station_code"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  .id <span class="op">=</span> <span class="va">country</span> <span class="op">==</span> <span class="st">"Finland"</span> <span class="op">&amp;</span></span>
<span>    <span class="va">species</span> <span class="op">==</span> <span class="st">"Perca fluviatilis"</span> <span class="op">&amp;</span></span>
<span>    <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2013</span> <span class="op">&amp;</span> </span>
<span>    <span class="op">!</span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD"</span>, <span class="st">"HG"</span>, <span class="st">"PB"</span>, <span class="st">"PFOS"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  matrix <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>    <span class="va">.id</span> <span class="op">&amp;</span> <span class="op">!</span><span class="op">(</span><span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRYWT%"</span>, <span class="st">"FATWT%"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="st">"MU&amp;EP"</span>,</span>
<span>    <span class="va">matrix</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk</span> <span class="op">&lt;-</span> <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.id</span> <span class="op">&amp;</span> <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRYWT%"</span>, <span class="st">"FATWT%"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    replicate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">replicate</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    matrix <span class="op">=</span> <span class="st">"MU&amp;EP"</span>,</span>
<span>    .id <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, .id <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>, <span class="va">wk</span><span class="op">)</span></span></code></pre></div>
<p>Ad-hoc change to merge methods of analysis for Poland for PYR10H</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  method_analysis <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>    <span class="va">alabo</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"IMWP"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"PYR1OH"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2020</span><span class="op">:</span><span class="fl">2021</span>,</span>
<span>    <span class="st">"HPLC-FD"</span>,</span>
<span>    <span class="va">method_analysis</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Ad-hoc change to <code>info_TEQ</code> to make it appropriate for
human health QS</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">info_TEQ</span><span class="op">[</span><span class="st">"CDFO"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.0003</span></span>
<span></span>
<span><span class="va">biota_data</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">country</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">biota_timeSeries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_create_timeSeries.html">ctsm_create_timeSeries</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span>,</span>
<span>  determinands.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    PFOS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N-PFOS"</span>, <span class="st">"BR-PFOS"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span>,</span>
<span>    SBDE6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BDE28"</span>, <span class="st">"BDE47"</span>, <span class="st">"BDE99"</span>, <span class="st">"BD100"</span>, <span class="st">"BD153"</span>, <span class="st">"BD154"</span><span class="op">)</span>, </span>
<span>      action <span class="op">=</span> <span class="st">"sum"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    HBCD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HBCDA"</span>, <span class="st">"HBCDB"</span>, <span class="st">"HBCDG"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span>,</span>
<span>    CB138 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"CB138+163"</span>, action <span class="op">=</span> <span class="st">"replace"</span><span class="op">)</span>,</span>
<span>    SCB6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CB28"</span>, <span class="st">"CB52"</span>, <span class="st">"CB101"</span>, <span class="st">"CB138"</span>, <span class="st">"CB153"</span>, <span class="st">"CB180"</span><span class="op">)</span>, </span>
<span>      action <span class="op">=</span> <span class="st">"sum"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    TEQDFP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">info_TEQ</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"bespoke"</span><span class="op">)</span>,</span>
<span>    VDS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"VDSI"</span>, action <span class="op">=</span> <span class="st">"bespoke"</span><span class="op">)</span>, </span>
<span>    INTS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="st">"INTSI"</span>, action <span class="op">=</span> <span class="st">"bespoke"</span><span class="op">)</span>,</span>
<span>    <span class="st">"LIPIDWT%"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EXLIP%"</span>, <span class="st">"FATWT%"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"bespoke"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  normalise <span class="op">=</span> <span class="va">ctsm_normalise_biota_HELCOM</span>,</span>
<span>  normalise.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    lipid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"simple"</span>, value <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>    other <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/biota' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/biota_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning data</span></span>
<span><span class="co">#&gt;    Stations in data not in station dictionary: deleted data in 'unidentified_stations.csv</span></span>
<span><span class="co">#&gt;    Dropping stations with no data between 2016 and 2021 </span></span>
<span><span class="co">#&gt;    Dropping samples with only auxiliary variables</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'sex': see sex_queries.csv</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'matrix': see matrix_queries.csv</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'basis': see basis_queries.csv</span></span>
<span><span class="co">#&gt;    imposex index units changed from 'idx' to 'st' before merging with individual data</span></span>
<span><span class="co">#&gt;    Bile metabolite units changed from 'ng/g' to 'ng/ml' and from 'ug/kg' to 'ug/l'</span></span>
<span><span class="co">#&gt; Warning in get.info.imposex(species, determinand, info$imposex, "min_value", :</span></span>
<span><span class="co">#&gt; Species determinand combinations not recognised: Tritia nitida (reticulata)</span></span>
<span><span class="co">#&gt; INTS, Buccinum undatum INTS, Buccinum undatum IMPS, Neptunea antiqua IMPS,</span></span>
<span><span class="co">#&gt; Neptunea antiqua INTS</span></span>
<span><span class="co">#&gt; Warning in get.info.imposex(species, determinand, info$imposex, "max_value", :</span></span>
<span><span class="co">#&gt; Species determinand combinations not recognised: Tritia nitida (reticulata)</span></span>
<span><span class="co">#&gt; INTS, Buccinum undatum INTS, Buccinum undatum IMPS, Neptunea antiqua IMPS,</span></span>
<span><span class="co">#&gt; Neptunea antiqua INTS</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'value': see value_queries.csv</span></span>
<span><span class="co">#&gt;    Replicate measurements, only first retained: see replicate_measurements.csv</span></span>
<span><span class="co">#&gt;    Non-positive detection limits: see non_positive_det_limits.csv</span></span>
<span><span class="co">#&gt;    Non-positive quantification limits: see non_positive_quant_limits.csv</span></span>
<span><span class="co">#&gt;    Limit of quantification less than limit of detection: see limits_inconsistent.csv</span></span>
<span><span class="co">#&gt;    Censoring codes D and Q inconsistent with respective limits: see censoring_codes_inconsistent.csv</span></span>
<span><span class="co">#&gt;    Detection limit higher than data: see detection_limit_high.csv</span></span>
<span><span class="co">#&gt;    Non-positive uncertainties: see non_positive_uncertainties.csv</span></span>
<span><span class="co">#&gt;    Large uncertainties: see large_uncertainties.csv</span></span>
<span><span class="co">#&gt;    Data submitted as N-PFOS, BR-PFOS summed to give PFOS</span></span>
<span><span class="co">#&gt;    Data submitted as BDE28, BDE47, BDE99, BD100, BD153, BD154 summed to give </span></span>
<span><span class="co">#&gt; SBDE6</span></span>
<span><span class="co">#&gt;      1624 of 3119 samples lost due to incomplete submissions</span></span>
<span><span class="co">#&gt;    Data submitted as HBCDA, HBCDB, HBCDG summed to give HBCD</span></span>
<span><span class="co">#&gt;      7 of 153 samples lost due to incomplete submissions</span></span>
<span><span class="co">#&gt;    Data submitted as CB138+163 relabelled as CB138 </span></span>
<span><span class="co">#&gt;    Data submitted as CB28, CB52, CB101, CB138, CB153, CB180 summed to give SCB6</span></span>
<span><span class="co">#&gt;      228 of 5190 samples lost due to incomplete submissions</span></span>
<span><span class="co">#&gt;    Data submitted as </span></span>
<span><span class="co">#&gt; CB77, CB81, CB105, CB118, CB126, CB156, CB157, CB167, CB169, CDD1N, CDD4X, CDD6P, CDD6X, CDD9X, CDDO, CDF2N, CDF2T, CDF4X, CDF6P, CDF6X, CDF9P, CDF9X, CDFO, CDFP2, CDFX1, TCDD </span></span>
<span><span class="co">#&gt; summed to give TEQDFP</span></span>
<span><span class="co">#&gt;      4989 of 5517 samples lost due to incomplete submissions</span></span>
<span><span class="co">#&gt;    inconsistent VDS and VDSI submitted in same year: see determinand_link_VDS.csv</span></span>
<span><span class="co">#&gt;    Data submitted as VDSIrelabelled as VDS</span></span>
<span><span class="co">#&gt;    Data submitted as EXLIP% or FATWT% relabelled as LIPIDWT% </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Creating time series data</span></span>
<span><span class="co">#&gt;    Converting data to appropriate basis for statistical analysis</span></span>
<span><span class="co">#&gt;    Losing 595 out of 40828 records in basis conversion due to missing, censored</span></span>
<span><span class="co">#&gt;    or zero drywt or lipidwt values.</span></span>
<span><span class="co">#&gt;    Dropping bivalve and gastropod contaminant data collected during the</span></span>
<span><span class="co">#&gt;     spawning season, which is taken to be the following months:</span></span>
<span><span class="co">#&gt;     April, May, June, July</span></span>
<span><span class="co">#&gt;    Normalising lipid to 5%</span></span>
<span><span class="co">#&gt;    No normalisation for other</span></span>
<span><span class="co">#&gt;    Dropping groups of compounds / stations with no data between 2016 and 2021</span></span></code></pre></div>
<p>Resolve Finnish perch changes</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  matrix <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>    <span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2013</span> <span class="op">&amp;</span> <span class="va">matrix</span> <span class="op">==</span> <span class="st">"MU&amp;EP"</span>, </span>
<span>    <span class="st">"MU"</span>, </span>
<span>    <span class="va">matrix</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Resolve Polish metoa changes</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span></span>
<span>  <span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  <span class="va">biota_data</span><span class="op">$</span><span class="va">stations</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"station_code"</span>, <span class="st">"country"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"station_code"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  <span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">data</span>, </span>
<span>  method_analysis <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Poland"</span> <span class="op">&amp;</span>  </span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"PYR1OH"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2020</span>,</span>
<span>    <span class="st">"HPLC-ESI-MS-MS"</span>, </span>
<span>    <span class="va">method_analysis</span></span>
<span>  <span class="op">)</span>, </span>
<span>  method_analysis <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span></span>
<span>    <span class="va">country</span> <span class="op">==</span> <span class="st">"Poland"</span> <span class="op">&amp;</span>  </span>
<span>      <span class="va">determinand</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"PYR1OH"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">2021</span>,</span>
<span>    <span class="st">"GC-MS-MS"</span>, </span>
<span>    <span class="va">method_analysis</span></span>
<span>  <span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">country</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sediment-1">Sediment<a class="anchor" aria-label="anchor" href="#sediment-1"></a>
</h3>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sediment_timeSeries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_create_timeSeries.html">ctsm_create_timeSeries</a></span><span class="op">(</span></span>
<span>  <span class="va">sediment_data</span>,</span>
<span>  determinands.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    SBDE6 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BDE28"</span>, <span class="st">"BDE47"</span>, <span class="st">"BDE99"</span>, <span class="st">"BD100"</span>, <span class="st">"BD153"</span>, <span class="st">"BD154"</span><span class="op">)</span>, </span>
<span>      action <span class="op">=</span> <span class="st">"sum"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    HBCD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HBCDA"</span>, <span class="st">"HBCDB"</span>, <span class="st">"HBCDG"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  normalise <span class="op">=</span> <span class="va">ctsm_normalise_sediment_HELCOM</span>,</span>
<span>  normalise.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    metals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"pivot"</span>, normaliser <span class="op">=</span> <span class="st">"AL"</span><span class="op">)</span>, </span>
<span>    copper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"hybrid"</span>, normaliser <span class="op">=</span> <span class="st">"CORG"</span>, value <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    organics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"simple"</span>, normaliser <span class="op">=</span> <span class="st">"CORG"</span>, value <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> </span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/sediment' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/sediment_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning data</span></span>
<span><span class="co">#&gt;    Stations in data not in station dictionary: deleted data in 'unidentified_stations.csv</span></span>
<span><span class="co">#&gt;    Dropping stations with no data between 2016 and 2021 </span></span>
<span><span class="co">#&gt;    Dropping samples with only auxiliary variables</span></span>
<span><span class="co">#&gt;    Relabelling matrix SED62 as SED63 and SED500, SED1000, SED2000 as SEDTOT</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'basis': see basis_queries.csv</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'value': see value_queries.csv</span></span>
<span><span class="co">#&gt;    Replicate measurements, only first retained: see replicate_measurements.csv</span></span>
<span><span class="co">#&gt;    Non-positive detection limits: see non_positive_det_limits.csv</span></span>
<span><span class="co">#&gt;    Non-positive quantification limits: see non_positive_quant_limits.csv</span></span>
<span><span class="co">#&gt;    Limit of quantification less than limit of detection: see limits_inconsistent.csv</span></span>
<span><span class="co">#&gt;    Censoring codes D and Q inconsistent with respective limits: see censoring_codes_inconsistent.csv</span></span>
<span><span class="co">#&gt;    Detection limit higher than data: see detection_limit_high.csv</span></span>
<span><span class="co">#&gt;    Non-positive uncertainties: see non_positive_uncertainties.csv</span></span>
<span><span class="co">#&gt;    Large uncertainties: see large_uncertainties.csv</span></span>
<span><span class="co">#&gt;    Data submitted as BDE28, BDE47, BDE99, BD100, BD153, BD154 summed to give </span></span>
<span><span class="co">#&gt; SBDE6</span></span>
<span><span class="co">#&gt;      33 of 115 samples lost due to incomplete submissions</span></span>
<span><span class="co">#&gt;    Data submitted as HBCDA, HBCDB, HBCDG summed to give HBCD</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Creating time series data</span></span>
<span><span class="co">#&gt;    Converting data to appropriate basis for statistical analysis</span></span>
<span><span class="co">#&gt;    Normalising copper to CORG using pivot values</span></span>
<span><span class="co">#&gt;    Removing sediment data where normaliser is a less than</span></span>
<span><span class="co">#&gt;    Normalising metals to AL using pivot values</span></span>
<span><span class="co">#&gt;    Normalising organics to 5% CORG</span></span>
<span><span class="co">#&gt;    Removing sediment data where normaliser is a less than</span></span>
<span><span class="co">#&gt;    Dropping groups of compounds / stations with no data between 2016 and 2021</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="water">Water<a class="anchor" aria-label="anchor" href="#water"></a>
</h3>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">water_timeSeries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_create_timeSeries.html">ctsm_create_timeSeries</a></span><span class="op">(</span></span>
<span>  <span class="va">water_data</span>,</span>
<span>  determinands.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    PFOS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N-PFOS"</span>, <span class="st">"BR-PFOS"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/water' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/water_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning data</span></span>
<span><span class="co">#&gt;    Dropping stations with no data between 2016 and 2021</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'basis': see basis_queries.csv</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'unit': see unit_queries.csv</span></span>
<span><span class="co">#&gt;    Non-positive detection limits: see non_positive_det_limits.csv</span></span>
<span><span class="co">#&gt;    Censoring codes D and Q inconsistent with respective limits: see censoring_codes_inconsistent.csv</span></span>
<span><span class="co">#&gt;    Detection limit higher than data: see detection_limit_high.csv</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Creating time series data</span></span>
<span><span class="co">#&gt;    Converting data to appropriate basis for statistical analysis</span></span>
<span><span class="co">#&gt;    Dropping groups of compounds / stations with no data between 2016 and 2021</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assessment">Assessment<a class="anchor" aria-label="anchor" href="#assessment"></a>
</h2>
<div class="section level3">
<h3 id="sediment-2">Sediment<a class="anchor" aria-label="anchor" href="#sediment-2"></a>
</h3>
<p>Main runs</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sediment_assessment</span> <span class="op">&lt;-</span> <span class="fu">ctsm_assessment</span><span class="op">(</span></span>
<span>  <span class="va">sediment_timeSeries</span>,</span>
<span>  AC <span class="op">=</span> <span class="st">"EQS"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Setting up clusters: be patient, it can take a while!</span></span></code></pre></div>
<p>Check convergence</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ctsm_check_convergence</span><span class="op">(</span><span class="va">sediment_assessment</span><span class="op">$</span><span class="va">assessment</span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="biota-2">Biota<a class="anchor" aria-label="anchor" href="#biota-2"></a>
</h3>
<p>Main runs</p>
<p>Preliminary analysis required for imposex assessment. Takes a long
time to run!!!!!</p>
</div>
<div class="section level3">
<h3 id="helcom-imposex-preparation">HELCOM imposex preparation<a class="anchor" aria-label="anchor" href="#helcom-imposex-preparation"></a>
</h3>
<p>Load the libraries</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tibble.tidyverse.org/" class="external-link">"tibble"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyr.tidyverse.org" class="external-link">"tidyr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"parallel"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/psolymos/pbapply" class="external-link">"pbapply"</a></span><span class="op">)</span></span></code></pre></div>
<p>Get the data</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  .imposex <span class="op">=</span> <span class="fu"><a href="../reference/ctsm_get_info.html">ctsm_get_info</a></span><span class="op">(</span></span>
<span>    <span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">determinand</span>, </span>
<span>    <span class="va">.data</span><span class="op">$</span><span class="va">determinand</span>, </span>
<span>    <span class="st">"group"</span>, </span>
<span>    <span class="st">"biota"</span>, </span>
<span>    sep <span class="op">=</span> <span class="st">"_"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="va">.imposex</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Imposex"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="va">wk_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"seriesID"</span>, <span class="st">"station_code"</span>, <span class="st">"year"</span>, <span class="st">"species"</span>, <span class="st">"determinand"</span>, </span>
<span>  <span class="st">"concentration"</span>, <span class="st">"n_individual"</span>, <span class="st">"%FEMALEPOP"</span></span>
<span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>  <span class="va">wk_data</span>, </span>
<span>  <span class="va">biota_timeSeries</span><span class="op">$</span><span class="va">stations</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"station_code"</span>, <span class="st">"country"</span>, <span class="st">"HELCOM_subbasin"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"station_code"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>See where we have individual data</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">is.integer</a></span><span class="op">(</span><span class="va">wk_data</span><span class="op">$</span><span class="va">n_individual</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="va">wk_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">station_code</span>, <span class="va">determinand</span>, <span class="va">species</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">n_individual</span> <span class="op">==</span> <span class="fl">1L</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">n_individual</span><span class="op">)</span></span></code></pre></div>
<p>Get cut points by country. We have used terminology from MIME code
(e.g. <code>regionID</code> = <code>country</code> here, whereas
<code>regionID</code> ~ <code>country</code> + <code>region</code> for
MIME).</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="st">"regionID"</span>, <span class="va">country</span>, sep <span class="op">=</span> <span class="st">" "</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We have difficulty dealing with Neptunea because nearly all zero and
gap in values (no records for class 2 or 3) for example:
<code>Denmark 28 1 0 0 1 0 0</code>.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">regionID</span>, <span class="va">concentration</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , species = Buccinum undatum</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          concentration</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark  815   35    2    3    4    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Littorina littorea</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          concentration</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark  227   75    8   69    0    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Neptunea antiqua</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          concentration</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark   28    1    0    0    1    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Peringia ulvae</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          concentration</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt;   Sweden  4243 1252  171   22   54   75   11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Tritia nitida (reticulata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          concentration</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark   37   55   13   47   54    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="va">wk_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">.data</span><span class="op">$</span><span class="va">species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Neptunea antiqua"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">determinand</span>, <span class="op">-</span><span class="st">"%FEMALEPOP"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">factor</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        seriesID     station_code       year     </span></span>
<span><span class="co">#&gt;  5972 VDS Peringia ulvae SB: 519   5972   : 519   Min.   :2007  </span></span>
<span><span class="co">#&gt;  6253 VDS Peringia ulvae SB: 457   6253   : 457   1st Qu.:2011  </span></span>
<span><span class="co">#&gt;  5846 VDS Peringia ulvae SB: 445   5846   : 445   Median :2014  </span></span>
<span><span class="co">#&gt;  6020 VDS Peringia ulvae SB: 423   6020   : 423   Mean   :2015  </span></span>
<span><span class="co">#&gt;  6241 VDS Peringia ulvae SB: 404   6241   : 404   3rd Qu.:2018  </span></span>
<span><span class="co">#&gt;  6098 VDS Peringia ulvae SB: 387   6098   : 387   Max.   :2021  </span></span>
<span><span class="co">#&gt;  (Other)                   :4637   (Other):4637                 </span></span>
<span><span class="co">#&gt;                        species     concentration       regionID   </span></span>
<span><span class="co">#&gt;  Buccinum undatum          : 859   Min.   :0.0000   Denmark:1444  </span></span>
<span><span class="co">#&gt;  Littorina littorea        : 379   1st Qu.:0.0000   Sweden :5828  </span></span>
<span><span class="co">#&gt;  Peringia ulvae            :5828   Median :0.0000                 </span></span>
<span><span class="co">#&gt;  Tritia nitida (reticulata): 206   Mean   :0.4286                 </span></span>
<span><span class="co">#&gt;                                    3rd Qu.:1.0000                 </span></span>
<span><span class="co">#&gt;                                    Max.   :6.0000                 </span></span>
<span><span class="co">#&gt;                                                                   </span></span>
<span><span class="co">#&gt;     country                   HELCOM_subbasin</span></span>
<span><span class="co">#&gt;  Denmark:1444   Arkona Basin          : 394  </span></span>
<span><span class="co">#&gt;  Sweden :5828   Bornholm Basin        :1222  </span></span>
<span><span class="co">#&gt;                 Great Belt            : 474  </span></span>
<span><span class="co">#&gt;                 Kattegat              : 877  </span></span>
<span><span class="co">#&gt;                 Northern Baltic Proper:1289  </span></span>
<span><span class="co">#&gt;                 The Sound             : 666  </span></span>
<span><span class="co">#&gt;                 Western Gotland Basin :2350</span></span></code></pre></div>
<p>Construct new variable VDS so we can combine larger categories with
few observations without changing the raw data.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">wk_data</span>, VDS <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">concentration</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">regionID</span>, <span class="va">VDS</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , species = Buccinum undatum</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          VDS</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark  815   35    2    3    4    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Littorina littorea</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          VDS</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark  227   75    8   69    0    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Peringia ulvae</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          VDS</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt;   Sweden  4243 1252  171   22   54   75   11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Tritia nitida (reticulata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          VDS</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark   37   55   13   47   54    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span></code></pre></div>
<p>Combine larger categories with few observations</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">id</span> <span class="op">&lt;-</span> <span class="va">species</span> <span class="op">==</span> <span class="st">"Buccinum undatum"</span></span>
<span>  <span class="va">VDS</span><span class="op">[</span><span class="va">id</span> <span class="op">&amp;</span> <span class="va">VDS</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">regionID</span>, <span class="va">VDS</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; , , species = Buccinum undatum</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          VDS</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark  815   35    9    0    0    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Littorina littorea</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          VDS</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark  227   75    8   69    0    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Peringia ulvae</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          VDS</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark    0    0    0    0    0    0    0</span></span>
<span><span class="co">#&gt;   Sweden  4243 1252  171   22   54   75   11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , species = Tritia nitida (reticulata)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          VDS</span></span>
<span><span class="co">#&gt; regionID     0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark   37   55   13   47   54    0    0</span></span>
<span><span class="co">#&gt;   Sweden     0    0    0    0    0    0    0</span></span></code></pre></div>
<p>Redefine <code>indexID</code> and <code>regionID</code> so don’t have
to worry about multiple species.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_data</span> <span class="op">&lt;-</span> <span class="va">wk_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span><span class="st">"indexID"</span>, <span class="va">station_code</span>, <span class="va">year</span>, <span class="va">species</span>, sep <span class="op">=</span> <span class="st">" "</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span><span class="st">"regionID"</span>, <span class="va">regionID</span>, <span class="va">species</span>, sep <span class="op">=</span> <span class="st">" "</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>indexID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">indexID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">regionID</span>, <span class="va">VDS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                     VDS</span></span>
<span><span class="co">#&gt; regionID                                0    1    2    3    4    5    6</span></span>
<span><span class="co">#&gt;   Denmark Buccinum undatum            815   35    9    0    0    0    0</span></span>
<span><span class="co">#&gt;   Denmark Littorina littorea          227   75    8   69    0    0    0</span></span>
<span><span class="co">#&gt;   Denmark Tritia nitida (reticulata)   37   55   13   47   54    0    0</span></span>
<span><span class="co">#&gt;   Sweden Peringia ulvae              4243 1252  171   22   54   75   11</span></span></code></pre></div>
<p>Split by <code>regionID</code>, estimate cut points and level for
each <code>indexID</code>.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wk_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="va">wk_data</span><span class="op">$</span><span class="va">regionID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wk.cores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">wk.cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="va">wk.cores</span> <span class="op">-</span> <span class="fl">1</span>, outfile <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span><span class="va">wk.cluster</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wk_split"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span><span class="va">wk.cluster</span>, <span class="va">ctsm.VDS.varlist</span>, envir <span class="op">=</span> <span class="fu"><a href="../reference/cstm.VDS.environment.html">cstm.VDS.environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clusterEvalQ(wk.cluster, {</span></span>
<span><span class="co">#   library("MASS")</span></span>
<span><span class="co"># })</span></span>
<span></span>
<span><span class="va">biota.VDS.estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pbapply/man/pbapply.html" class="external-link">pblapply</a></span><span class="op">(</span></span>
<span>  <span class="va">wk_split</span>, </span>
<span>  <span class="va">ctsm.VDS.index.opt</span>, </span>
<span>  calc.vcov <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  cl <span class="op">=</span> <span class="va">wk.cluster</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">wk.cluster</span><span class="op">)</span></span></code></pre></div>
<p>Check convergence</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">biota.VDS.estimates</span>, <span class="st">"[["</span>, <span class="st">"convergence"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># saveRDS(</span></span>
<span><span class="co">#   biota.VDS.estimates,</span></span>
<span><span class="co">#   file.path("RData", "VDS estimates.rds")</span></span>
<span><span class="co"># )</span></span></code></pre></div>
<p>Get confidence limits on estimated VDSI for each
<code>indexID</code>.</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">230504</span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota.VDS.cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">biota.VDS.estimates</span>, <span class="va">ctsm.VDS.cl</span><span class="op">)</span></span>
<span><span class="va">biota.VDS.cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">biota.VDS.cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">biota.VDS.cl</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span></span>
<span>  <span class="va">paste</span>, </span>
<span>  <span class="va">biota.VDS.cl</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"station_code"</span>, <span class="st">"year"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">biota.VDS.cl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">factor</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;      lower              upper                              species   </span></span>
<span><span class="co">#&gt;  Min.   :0.003795   Min.   :0.1038   Buccinum undatum          : 26  </span></span>
<span><span class="co">#&gt;  1st Qu.:0.053665   1st Qu.:0.3215   Littorina littorea        : 17  </span></span>
<span><span class="co">#&gt;  Median :0.147798   Median :0.5178   Peringia ulvae            :196  </span></span>
<span><span class="co">#&gt;  Mean   :0.315700   Mean   :0.7408   Tritia nitida (reticulata): 10  </span></span>
<span><span class="co">#&gt;  3rd Qu.:0.423762   3rd Qu.:0.9429                                   </span></span>
<span><span class="co">#&gt;  Max.   :3.529276   Max.   :3.9709                                   </span></span>
<span><span class="co">#&gt;                                                                      </span></span>
<span><span class="co">#&gt;       year       station_code</span></span>
<span><span class="co">#&gt;  Min.   :2007   5799   : 13  </span></span>
<span><span class="co">#&gt;  1st Qu.:2011   5846   : 13  </span></span>
<span><span class="co">#&gt;  Median :2015   5972   : 13  </span></span>
<span><span class="co">#&gt;  Mean   :2015   6020   : 13  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2018   6086   : 13  </span></span>
<span><span class="co">#&gt;  Max.   :2021   6098   : 13  </span></span>
<span><span class="co">#&gt;                 (Other):171</span></span>
<span></span>
<span><span class="co"># saveRDS(</span></span>
<span><span class="co">#   biota.VDS.cl,</span></span>
<span><span class="co">#   file.path("RData", "VDS confidence limits.rds")</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">wk_data</span>, <span class="va">wk_split</span>, <span class="va">wk.cluster</span>, <span class="va">wk.cores</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rob Fryer, Leszek Kaliciak, Scottish Government, AmbieSense Ltd, Helsinki Commission (HELCOM), Arctic Monitoring and Assessment Programme (AMAP), OSPAR Commission (OSPAR).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
