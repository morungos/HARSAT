<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="harsat">
<title>Getting started • harsat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started">
<meta property="og:description" content="harsat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">harsat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.1000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/harsat.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>File formats</h6>
    <a class="dropdown-item" href="../articles/external-file-format.html">External file format</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Examples</h6>
    <a class="dropdown-item" href="../articles/example_external_data.html">External data</a>
    <a class="dropdown-item" href="../articles/example_simple_ospar.html">Simple OSPAR</a>
    <a class="dropdown-item" href="../articles/example_helcom.html">HELCOM</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/osparcomm/HARSAT/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/osparcomm/HARSAT/blob/HEAD/vignettes/harsat.Rmd" class="external-link"><code>vignettes/harsat.Rmd</code></a></small>
      <div class="d-none name"><code>harsat.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>For now, we will assume that you are familiar with running basic R
scripts and so on. We will focus on what the structure of a typical what
the code looks like in a typical analysis.</p>
</div>
<div class="section level2">
<h2 id="installing-harsat-from-github">Installing <code>harsat</code> from GitHub<a class="anchor" aria-label="anchor" href="#installing-harsat-from-github"></a>
</h2>
<p>To install the latest development version, use the
<code>remotes</code> package:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"osparcomm/harsat"</span>, auth_token <span class="op">=</span> <span class="st">'XXXX'</span><span class="op">)</span> </span></code></pre>
<blockquote>
<p>Note: during development the repository is marked as private on
GitHub, so you will need a Personal Access Token (or PAT) to access it.
Follow <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-fine-grained-personal-access-token" class="external-link">these
instructions to create a Personal Access Token</a>. It’ll be a short
string, probably beginning with <code>ghp_</code>. Put the whole string
into the <code>auth_token</code> parameter, and that should install the
<code>harsat</code> package directly.</p>
</blockquote>
<blockquote>
<p>Note: many of the functions currently have a <code>cstm</code>
prefix. When the code was originally developed, we thought of it as
“contaminant time series modelling”, which is why you get all these
<code>cstm</code> prefixes. These will be removed in the near
future.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="loading-the-code">Loading the code<a class="anchor" aria-label="anchor" href="#loading-the-code"></a>
</h2>
<p>Now, within R, you can load the library in the usual way</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/osparcomm/HARSAT" class="external-link">harsat</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-files">Accessing files<a class="anchor" aria-label="anchor" href="#accessing-files"></a>
</h2>
<p>How you organize your files is up to you. We will start from the
current working directory. We’ll detect that using R’s <code>here</code>
package, and write it into a variable
<code>working.directory</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="va">working.directory</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-in-the-data">Reading in the data<a class="anchor" aria-label="anchor" href="#reading-in-the-data"></a>
</h2>
<p>The first step is to read in the data that we’ve got. We will go
through some of these arguments.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data.html">read_data</a></span><span class="op">(</span></span>
<span>  compartment <span class="op">=</span> <span class="st">"biota"</span>, </span>
<span>  purpose <span class="op">=</span> <span class="st">"OSPAR"</span>,                               </span>
<span>  contaminants <span class="op">=</span> <span class="st">"test_data.csv"</span>, </span>
<span>  stations <span class="op">=</span> <span class="st">"station_dictionary.csv"</span>, </span>
<span>  QA <span class="op">=</span> <span class="st">"quality_assurance.csv"</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"data"</span>, <span class="st">"example_simple_OSPAR"</span><span class="op">)</span>,</span>
<span>  data_format <span class="op">=</span> <span class="st">"ICES_old"</span>,</span>
<span>  info_files <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    determinand <span class="op">=</span> <span class="st">"determinand_simple_OSPAR.csv"</span>, </span>
<span>    thresholds <span class="op">=</span> <span class="st">"thresholds_biota_simple_OSPAR.csv"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  info_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"information"</span><span class="op">)</span>, </span>
<span>  extraction <span class="op">=</span> <span class="st">"2022/01/11"</span>,</span>
<span>  max_year <span class="op">=</span> <span class="fl">2020L</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading station dictionary from:</span></span>
<span><span class="co">#&gt;  '/Users/stuart/git/HARSAT/data/example_simple_OSPAR/station_dictionary.csv'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reading contaminant and biological effects data from:</span></span>
<span><span class="co">#&gt;  '/Users/stuart/git/HARSAT/data/example_simple_OSPAR/test_data.csv'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reading QA data from '/Users/stuart/git/HARSAT/data/example_simple_OSPAR/quality_assurance.csv'</span></span></code></pre></div>
<p>The main arguments here are as follows:</p>
<ul>
<li>
<code>compartment</code> is an argument which specifies whether
we’re dealing with a biota assessment, a sediment assessment, or a water
assessment.</li>
<li>
<code>purpose</code> means we can mirror an <code>OSPAR</code> style
assessment, a <code>HELCOM</code> style assessment, an
<code>AMAP</code>-style assessment, or <code>other</code> which means
you can basically tailor it yourself and the idea is that the code will
be sufficiently flexible that you can do a lot of tailoring to suit your
own needs.</li>
<li>
<code>contaminants</code> is a data file which has all the chemical
measurements in it.</li>
<li>
<code>stations</code> is the station file which is directly related
to the station dictionary that we get out at from ICES.</li>
<li>
<code>QA</code> is a quality assurance file – this is
<em>deprecated</em> and will disappear.</li>
<li>
<code>info_files</code> are reference tables – we come back to
that.</li>
</ul>
<p>This reads in the three data sets, but does no more than that at this
stage.</p>
<p>Once you get to this point, you can look at the data if you want to,
or do anything else that you need with the data before proceeding.
Essentially the files that come in at this point are unchanged from the
files that we are reading them in from. This is basically just reading
in the data and setting things up.</p>
<p>At this point we might want to do a whole lot of <em>ad hoc</em>
corrections to these data, as is done with the OSPAR estimates.</p>
</div>
<div class="section level2">
<h2 id="tidying-the-data">Tidying the data<a class="anchor" aria-label="anchor" href="#tidying-the-data"></a>
</h2>
<p>The next step is to clean the data to prepare for analysis. This step
tidies up the data structures that we’ve got there. It does filtering so
that we get data in the form that we want for say, an OSPAR assessment
or a HELCOM assessment. It also streamlines some of the data files.</p>
<p>This may generate warnings. For example, when we’re cleaning the
station dictionary, we’ve may find some issues with duplicate stations.
Similarly, when it comes to cleaning the contaminant and biological
effects data, we’ve may find some data from stations which are
unrecognized by the station dictionary. Sometimes that’s fine and
sometimes that’s not. Warnings are supported by output files which allow
you to come in and have a look and see which values are affected, so you
can go and check them out in more detail.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_tidy_data.html">ctsm_tidy_data</a></span><span class="op">(</span><span class="va">biota_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/biota' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/biota_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning station dictionary</span></span>
<span><span class="co">#&gt;    Duplicate stations - first one selected: see duplicate_stations.csv</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning contaminant and biological effects data</span></span>
<span><span class="co">#&gt;    Submitted.station unrecognised by dictionary: see stations_unrecognised.csv</span></span>
<span><span class="co">#&gt;    Dropping data with no stations</span></span></code></pre></div>
<p>To this point, we’ve still not done anything with the datasets.</p>
</div>
<div class="section level2">
<h2 id="create-time-series">Create time series<a class="anchor" aria-label="anchor" href="#create-time-series"></a>
</h2>
<p>Now we can group the data into time series. This means identifying
which data points belong to the same time series, and then set it up as
a structure which then allows us to do the assessments.</p>
<p>There are various different ways in which we can specify which
determinants we actually want to assess. In this case, the
<code>determinands</code> parameter specifies cadmium, CP153, CB153,
HBCD, HBCDA, HBCDG, and some biological metabolites. There are various
other arguments which allow you to control just how the data are
manipulated.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_timeSeries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctsm_create_timeSeries.html">ctsm_create_timeSeries</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_data</span>,</span>
<span>  determinands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD"</span>, <span class="st">"CB153"</span>, <span class="st">"HBCD"</span>,<span class="st">"HBCDA"</span>, <span class="st">"HBCDG"</span>, <span class="st">"PYR1OH"</span><span class="op">)</span>,</span>
<span>  determinands.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    HBCD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"HBCDA"</span>, <span class="st">"HBCDB"</span>, <span class="st">"HBCDG"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span>,</span>
<span>    <span class="st">"LIPIDWT%"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>det <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EXLIP%"</span>, <span class="st">"FATWT%"</span><span class="op">)</span>, action <span class="op">=</span> <span class="st">"bespoke"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  get_basis <span class="op">=</span> <span class="va">get_basis_biota_OSPAR</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Oddities will be written to 'oddities/biota' with previous oddities backed up to</span></span>
<span><span class="co">#&gt;  'oddities/biota_backup'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cleaning data</span></span>
<span><span class="co">#&gt;    Dropping stations with no data between 2015 and 2020 </span></span>
<span><span class="co">#&gt;    Dropping samples with only auxiliary variables</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'matrix': see matrix_queries.csv</span></span>
<span><span class="co">#&gt;    Unexpected or missing values for 'basis': see basis_queries.csv</span></span>
<span><span class="co">#&gt;    Bile metabolite units changed from 'ng/g' to 'ng/ml' and from 'ug/kg' to 'ug/l'</span></span>
<span><span class="co">#&gt;    Replicate measurements, only first retained: see replicate_measurements.csv</span></span>
<span><span class="co">#&gt;    Limit of quantification less than limit of detection: see limits_inconsistent.csv</span></span>
<span><span class="co">#&gt;    Detection limit higher than data: see detection_limit_high.csv</span></span>
<span><span class="co">#&gt;    Data submitted as HBCDA, HBCDB, HBCDG summed to give HBCD</span></span>
<span><span class="co">#&gt;    Data submitted as EXLIP% or FATWT% relabelled as LIPIDWT% </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Creating time series data</span></span>
<span><span class="co">#&gt;    Converting data to appropriate basis for statistical analysis</span></span>
<span><span class="co">#&gt;    Losing 32 out of 392 records in basis conversion due to missing, censored</span></span>
<span><span class="co">#&gt;    or zero drywt or lipidwt values.</span></span>
<span><span class="co">#&gt;    Dropping bivalve and gastropod contaminant data collected during the</span></span>
<span><span class="co">#&gt;     spawning season, which is taken to be the following months:</span></span>
<span><span class="co">#&gt;     April, May, June, July </span></span>
<span><span class="co">#&gt;    Dropping groups of compounds / stations with no data between 2015 and 2020</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="assessment">Assessment<a class="anchor" aria-label="anchor" href="#assessment"></a>
</h2>
<p>The next the next stage is to do the assessment.</p>
<p>We’ve created a time series object, and pass that into this call. We
have to say which thresholds we’re going to use when we do the
assessment and there are other options which we can put in here. But
this will just run. You can see that it tells you which time series
we’re actually assessing as it progresses. This gives you an idea of how
how many cups of tea you can drink before it’s all finished.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">biota_assessment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_assessment.html">run_assessment</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_timeSeries</span>,</span>
<span>  AC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BAC"</span>, <span class="st">"EAC"</span>, <span class="st">"EQS"</span>, <span class="st">"HQS"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 11461; determinand CB153; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 11461; determinand CD; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 12156; determinand CD; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 12164; determinand CB153; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 12164; determinand CD; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1235; determinand CB153; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1235; determinand CD; species Crassostrea gigas; matrix SB; basis D; unit ug/kg</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1235; determinand HBCD; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1235; determinand HBCDA; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1235; determinand HBCDG; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 13059; determinand CB153; species Spisula solida; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 13059; determinand CD; species Spisula solida; matrix SB; basis D; unit ug/kg</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1345; determinand CB153; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1345; determinand CD; species Crassostrea gigas; matrix SB; basis D; unit ug/kg</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1345; determinand HBCD; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1345; determinand HBCDA; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1345; determinand HBCDG; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1381; determinand CB153; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1381; determinand CD; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1381; determinand HBCD; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1381; determinand HBCDA; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1381; determinand HBCDG; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1388; determinand CB153; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 1388; determinand CD; species Crassostrea gigas; matrix SB; basis D; unit ug/kg</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 2717; determinand PYR1OH; species Limanda limanda; matrix BI; method_analysis HPLC-FD; unit ng/ml </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 3282; determinand CB153; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 3282; determinand CD; species Crassostrea gigas; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 3433; determinand CB153; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 3433; determinand CD; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 3441; determinand CB153; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 3441; determinand CD; species Mytilus edulis; matrix SB; basis D; unit ug/kg</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 7132; determinand CB153; species Mytilus edulis; matrix SB; basis D; unit ug/kg </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; assessing series:  station_code 7132; determinand CD; species Mytilus edulis; matrix SB; basis D; unit ug/kg</span></span></code></pre></div>
<p>There are various little warnings: these ones are nothing to worry
about.</p>
<p>We can then check that everything is converged.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">check_convergence</span><span class="op">(</span><span class="va">biota_assessment</span><span class="op">$</span><span class="va">assessment</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in check_convergence(biota_assessment$assessment): could not find function "check_convergence"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reporting">Reporting<a class="anchor" aria-label="anchor" href="#reporting"></a>
</h2>
<p>We can then get a summary table of our results. We want a direcrory
where we can put it. And <code>harsat</code> won’t create a directory if
there’s nothing there, so let’s make a new directory,
<code>./output/tutorial</code>, and put the full path into
<code>summary.dir</code>, so we can tell <code>harsat</code> where to
write to.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">working.directory</span>, <span class="st">"output"</span>, <span class="st">"tutorial"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">summary.dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">summary.dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, we set up a few variables to manage the display.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">webGroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Metals"</span>, <span class="st">"Metabolites"</span>, <span class="st">"Organobromines"</span>, <span class="st">"Chlorobiphenyls"</span><span class="op">)</span>,  </span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Metals"</span>, <span class="st">"PAH metabolites"</span>, <span class="st">"Organobromines"</span>,  <span class="st">"Polychlorinated biphenyls"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">classColour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  below <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"BAC"</span> <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>    <span class="st">"EAC"</span> <span class="op">=</span> <span class="st">"green"</span>, </span>
<span>    <span class="st">"EQS"</span> <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>    <span class="st">"HQS"</span> <span class="op">=</span> <span class="st">"green"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  above <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"BAC"</span> <span class="op">=</span> <span class="st">"orange"</span>, </span>
<span>    <span class="st">"EAC"</span> <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>    <span class="st">"EQS"</span> <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    <span class="st">"HQS"</span> <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span>, </span>
<span>  none <span class="op">=</span> <span class="st">"black"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And then we can generate the summary proper. The summary file which
will be very familiar to those who have been involved in the OSPAR and
the HELCOM assessments. The summary files have information about each
time series, what the time series represents (which is the first set of
columns), followed by statistical results, such as p values, and summary
values such as the number of years in the data set, when it starts and
finishes. And towards the end, we’ve got comparisons against various
different threshold values.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_summary_table.html">write_summary_table</a></span><span class="op">(</span></span>
<span>  <span class="va">biota_assessment</span>, </span>
<span>  determinandGroups <span class="op">=</span> <span class="va">webGroups</span>,</span>
<span>  classColour <span class="op">=</span> <span class="va">classColour</span>,</span>
<span>  collapse_AC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>EAC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EAC"</span>, <span class="st">"EQS"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="va">summary.dir</span> </span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rob Fryer, Leszek Kaliciak, Scottish Government, AmbieSense Ltd, Helsinki Commission (HELCOM), Arctic Monitoring and Assessment Programme (AMAP), OSPAR Commission (OSPAR).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
